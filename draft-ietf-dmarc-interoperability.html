<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Interoperability Issues Between DMARC and Indirect Email Flows</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Document Conventions"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Causes of Interoperability Issues"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Originator vs Receiver Perspective"/>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Identifier Alignment"/>
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Message Forwarding"/>
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 Message Modification"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Internet Mail Architecture, DMARC, and Indirect Email Flows"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Message Handling System"/>
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 Message Submission Agents"/>
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 Message Transfer Agents"/>
<link href="#rfc.section.3.1.2.1" rel="Chapter" title="3.1.2.1 Message Encoding"/>
<link href="#rfc.section.3.1.2.2" rel="Chapter" title="3.1.2.2 Header Standardization"/>
<link href="#rfc.section.3.1.2.3" rel="Chapter" title="3.1.2.3 Email Address Internationalization"/>
<link href="#rfc.section.3.1.3" rel="Chapter" title="3.1.3 Message Delivery Agents"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Mediators"/>
<link href="#rfc.section.3.2.1" rel="Chapter" title="3.2.1 Alias"/>
<link href="#rfc.section.3.2.2" rel="Chapter" title="3.2.2 ReSenders"/>
<link href="#rfc.section.3.2.3" rel="Chapter" title="3.2.3 Mailing Lists"/>
<link href="#rfc.section.3.2.4" rel="Chapter" title="3.2.4 Gateways"/>
<link href="#rfc.section.3.2.5" rel="Chapter" title="3.2.5 Boundary Filters"/>
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Combinations"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Possible Mitigations of Interoperability Issues"/>
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Mitigations in Current Use"/>
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 Mitigations for Senders"/>
<link href="#rfc.section.4.1.1.1" rel="Chapter" title="4.1.1.1 Identifier Alignment"/>
<link href="#rfc.section.4.1.1.2" rel="Chapter" title="4.1.1.2 Message Modification"/>
<link href="#rfc.section.4.1.2" rel="Chapter" title="4.1.2 Mitigations for Receivers"/>
<link href="#rfc.section.4.1.2.1" rel="Chapter" title="4.1.2.1 Identifier Alignment"/>
<link href="#rfc.section.4.1.2.2" rel="Chapter" title="4.1.2.2 Policy Override"/>
<link href="#rfc.section.4.1.2.3" rel="Chapter" title="4.1.2.3 Email Address Internationalization"/>
<link href="#rfc.section.4.1.3" rel="Chapter" title="4.1.3 Mitigations for ReSenders"/>
<link href="#rfc.section.4.1.3.1" rel="Chapter" title="4.1.3.1 Changes to the RFC5322.From"/>
<link href="#rfc.section.4.1.3.2" rel="Chapter" title="4.1.3.2 Avoiding Message Modification"/>
<link href="#rfc.section.4.1.3.3" rel="Chapter" title="4.1.3.3 Mailing Lists"/>
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Proposed and In-Progress Mitigations"/>
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 Getting More Radical: Requiring New Communication Paths Between MUAs"/>
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgments"/>
<link href="#rfc.references" rel="Chapter" title="8 References"/>
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.4.8 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Martin, F., Ed., Lear, E., Ed., Draegen, T., Ed., and E. Zwicky, Ed." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-dmarc-interoperability-02" />
  <meta name="dct.issued" scheme="ISO8601" content="2015-4-29" />
  <meta name="dct.abstract" content="DMARC introduces a mechanism for expressing domain-level policies and preferences for email message validation, disposition, and reporting.  The DMARC mechanism can encounter interoperability issues when messages do not flow directly from the author's administrative domain to the final recipients. Collectively these email flows are referred to as indirect email flows.  This document describes interoperability issues between DMARC and indirect email flows. Possible methods for addressing interoperability issues are presented." />
  <meta name="description" content="DMARC introduces a mechanism for expressing domain-level policies and preferences for email message validation, disposition, and reporting.  The DMARC mechanism can encounter interoperability issues when messages do not flow directly from the author's administrative domain to the final recipients. Collectively these email flows are referred to as indirect email flows.  This document describes interoperability issues between DMARC and indirect email flows. Possible methods for addressing interoperability issues are presented." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">DMARC Working Group</td>
  <td class="right">F. Martin, Ed.</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">LinkedIn</td>
</tr>
<tr>
  <td class="left">Intended status: Informational</td>
  <td class="right">E. Lear, Ed.</td>
</tr>
<tr>
  <td class="left">Expires: October 31, 2015</td>
  <td class="right">Cisco Systems GmbH</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">T. Draegen, Ed.</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Eudaemonic Development LLC</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">E. Zwicky, Ed.</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Yahoo</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">April 29, 2015</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Interoperability Issues Between DMARC and Indirect Email Flows<br />
  <span class="filename">draft-ietf-dmarc-interoperability-02</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>DMARC introduces a mechanism for expressing domain-level policies and preferences for email message validation, disposition, and reporting.  The DMARC mechanism can encounter interoperability issues when messages do not flow directly from the author's administrative domain to the final recipients. Collectively these email flows are referred to as indirect email flows.  This document describes interoperability issues between DMARC and indirect email flows. Possible methods for addressing interoperability issues are presented.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on October 31, 2015.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2015 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>1.1.   <a href="#rfc.section.1.1">Document Conventions</a></li>
<li>2.   <a href="#rfc.section.2">Causes of Interoperability Issues</a></li>
<li>2.1.   <a href="#rfc.section.2.1">Originator vs Receiver Perspective</a></li>
<li>2.2.   <a href="#rfc.section.2.2">Identifier Alignment</a></li>
<li>2.3.   <a href="#rfc.section.2.3">Message Forwarding</a></li>
<li>2.4.   <a href="#rfc.section.2.4">Message Modification</a></li>
<li>3.   <a href="#rfc.section.3">Internet Mail Architecture, DMARC, and Indirect Email Flows</a></li>
<li>3.1.   <a href="#rfc.section.3.1">Message Handling System</a></li>
<li>3.1.1.   <a href="#rfc.section.3.1.1">Message Submission Agents</a></li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">Message Transfer Agents</a></li>
<li>3.1.2.1.   <a href="#rfc.section.3.1.2.1">Message Encoding</a></li>
<li>3.1.2.2.   <a href="#rfc.section.3.1.2.2">Header Standardization</a></li>
<li>3.1.2.3.   <a href="#rfc.section.3.1.2.3">Email Address Internationalization</a></li>
<li>3.1.3.   <a href="#rfc.section.3.1.3">Message Delivery Agents</a></li>
<li>3.2.   <a href="#rfc.section.3.2">Mediators</a></li>
<li>3.2.1.   <a href="#rfc.section.3.2.1">Alias</a></li>
<li>3.2.2.   <a href="#rfc.section.3.2.2">ReSenders</a></li>
<li>3.2.3.   <a href="#rfc.section.3.2.3">Mailing Lists</a></li>
<li>3.2.4.   <a href="#rfc.section.3.2.4">Gateways</a></li>
<li>3.2.5.   <a href="#rfc.section.3.2.5">Boundary Filters</a></li>
<li>3.3.   <a href="#rfc.section.3.3">Combinations</a></li>
<li>4.   <a href="#rfc.section.4">Possible Mitigations of Interoperability Issues</a></li>
<li>4.1.   <a href="#rfc.section.4.1">Mitigations in Current Use</a></li>
<li>4.1.1.   <a href="#rfc.section.4.1.1">Mitigations for Senders</a></li>
<li>4.1.1.1.   <a href="#rfc.section.4.1.1.1">Identifier Alignment</a></li>
<li>4.1.1.2.   <a href="#rfc.section.4.1.1.2">Message Modification</a></li>
<li>4.1.2.   <a href="#rfc.section.4.1.2">Mitigations for Receivers</a></li>
<li>4.1.2.1.   <a href="#rfc.section.4.1.2.1">Identifier Alignment</a></li>
<li>4.1.2.2.   <a href="#rfc.section.4.1.2.2">Policy Override</a></li>
<li>4.1.2.3.   <a href="#rfc.section.4.1.2.3">Email Address Internationalization</a></li>
<li>4.1.3.   <a href="#rfc.section.4.1.3">Mitigations for ReSenders</a></li>
<li>4.1.3.1.   <a href="#rfc.section.4.1.3.1">Changes to the RFC5322.From</a></li>
<li>4.1.3.2.   <a href="#rfc.section.4.1.3.2">Avoiding Message Modification</a></li>
<li>4.1.3.3.   <a href="#rfc.section.4.1.3.3">Mailing Lists</a></li>
<li>4.2.   <a href="#rfc.section.4.2">Proposed and In-Progress Mitigations</a></li>
<li>4.2.1.   <a href="#rfc.section.4.2.1">Getting More Radical: Requiring New Communication Paths Between MUAs</a></li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a></li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a></li>
<li>7.   <a href="#rfc.section.7">Acknowledgments</a></li>
<li>8.   <a href="#rfc.references">References</a></li>
<li>8.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> Introduction</h1>
<p><a href="#RFC7489">DMARC</a> <cite title="NONE">[RFC7489]</cite> introduces a mechanism for expressing domain-level policies and preferences for message validation, disposition, and reporting.  The DMARC mechanism can encounter several different types of interoperability issues due to third-party message sourcing, message transformation or rerouting.</p>
<p id="rfc.section.1.p.2">DMARC is, as this writing, an Informational RFC, however it has a significant deployment within the email community.</p>
<p id="rfc.section.1.p.3">Cases in which email does not flow directly from the author's administrative domain to the recipients are collectively referred to in this document as indirect email flows.  Due to existing and increasing adoption of DMARC, the impact of DMARC-based email rejection policies on both direct and indirect email flows can be significant. </p>
<p id="rfc.section.1.p.4">Several known causes of interoperability issues are presented, followed by a description of components within the Internet Mail Architecture <a href="#RFC5598">[RFC5598]</a> where interoperability issues can arise.</p>
<p id="rfc.section.1.p.5">Lastly, known and possible methods for addressing interoperability issues are presented.  There are often multiple ways to address any given interoperability issue.  While this document strives to be comprehensive in its review, it should not be treated as complete.</p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> Document Conventions</h1>
<p id="rfc.section.1.1.p.1">Notation regarding structured fields is taken from <a href="#RFC5598">[RFC5598]</a>.</p>
<p id="rfc.section.1.1.p.2">Organizational Domain and Authenticated Identifiers are specified in <a href="#RFC7489">DMARC</a> <cite title="NONE">[RFC7489]</cite>.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> Causes of Interoperability Issues</h1>
<p id="rfc.section.2.p.1">Interoperability issues between DMARC and indirect email flows arise when conformance to the DMARC specification leads an implementation to apply DMARC based policy to messages that are both compliant with the architecture as specified in <a href="#RFC5598">[RFC5598]</a> and viewed as legitimate by the intended recipient. To be clear, this document does not address emails considered legitimate by the intended recipient but which are not conformant to other email specifications. The rest of this section describes several conceptual causes of interoperability issues.</p>
<h1 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> Originator vs Receiver Perspective</h1>
<p id="rfc.section.2.1.p.1">Some Receivers are concerned that wanted email messages are received, regardless if such email messages are not strictly in conformance to any standard or protocol.</p>
<p id="rfc.section.2.1.p.2">Some Originators, particularly for high value transactional messages, want the message discarded if it passes through an intermediary and is modified in any way resulting in a failure to validate. Examples of such messages include those related to financial organizations and medical establishments.</p>
<h1 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> Identifier Alignment</h1>
<p id="rfc.section.2.2.p.1">DMARC relies on <a href="#RFC6376">DKIM</a> <cite title="NONE">[RFC6376]</cite> and <a href="#RFC7208">SPF</a> <cite title="NONE">[RFC7208]</cite> to perform message source validation.  The <a href="#RFC7489">DMARC</a> <cite title="NONE">[RFC7489]</cite> mechanism refers to source domains that are validated by DKIM or SPF as Authenticated Identifiers.  DMARC requires an Authenticated Identifier to be relevant to the domain found in the message's RFC5322.From header field <a href="#RFC5322">[RFC5322]</a>. This relevancy  is referred to as Identifier Alignment.</p>
<p id="rfc.section.2.2.p.2">Identifier Alignment can be strict, where the domains exactly match each others, or relaxed where the domains are part of the same Organizational Domain. There are, in general, the same interoperability issues between strict and relaxed alignment, however in strict mode the possible solutions are more constrained when possible. This Document mainly implies relaxed Identifier Alignment.</p>
<p id="rfc.section.2.2.p.3">DKIM provides a cryptographic means for a domain to be associated with a particular message. DKIM does not make any constraints on what domains may or must present this association. However, for a DKIM identifier to align in DMARC, the signing domain of a valid signature must be part of the same Organizational Domain as the domain in the RFC5322.From header field <a href="#RFC5322">[RFC5322]</a>. </p>
<p id="rfc.section.2.2.p.4">In addition, DKIM allows for the possibility of multiple valid signatures.  The DMARC mechanism will process Authenticated Identifiers that are based on DKIM signatures until an aligned Authenticated Identifier is found (if any). However, operational experience has shown that some implementations have difficulty processing multiple signatures.  The impact on DMARC processing is clear: implementations that cannot process multiple DKIM signatures may erroneously apply DMARC based policy to otherwise legitimate messages. </p>
<p id="rfc.section.2.2.p.5">SPF can provide two Authenticated Identifiers based on two different SPF identities: <a href="#RFC7208">RFC7208.HELO</a> <cite title="NONE">[RFC7208]</cite> and <a href="#RFC7208">RFC7208.MAILFROM</a> <cite title="NONE">[RFC7208]</cite>. DMARC uses only the RFC7208.MAILFROM identifier for alignment. The SPF validated domain in RFC7208.MAILFROM must be part of the same Organizational Domain as the domain in the RFC5322.From header field to be aligned. It is important to note that even when an SPF record exists for the domain in RFC5322.From, SPF will not authenticate it unless it is also the domain in RFC7208.MAILFROM, furthermore, RFC7208.MAILFROM definition is different from <a href="#RFC5321">RFC5321.MailFrom</a> <cite title="NONE">[RFC5321]</cite> definition.</p>
<h1 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a> Message Forwarding</h1>
<p id="rfc.section.2.3.p.1">Message forwarding is a generic concept encapsulating a variety of behaviors.  <a href="#IMA_DMARC">Section 3</a> describes forwarding behavior as it relates to the components of the Internet Mail Architecture.</p>
<p id="rfc.section.2.3.p.2">All of these behaviors involve email being retransmitted by a new SMTP server. As discussed above, for SPF to cause a DMARC pass, the domain of the RFC7208.MAILFROM, must be aligned with that of the RFC5322.From header field: </p>

<ul>
  <li>If the RFC5321.MailFrom is not empty and if the forwarder keeps the RFC5321.MailFrom, the SPF validation will fail altogether unless the forwarder is an authorized part of the originator's email sending infrastructure. On another hand, if the forwarder uses its own domain in the RFC5321.MailFrom, SPF passes but the alignment with the RFC5322.From header field fails.</li>
  <li>If the RFC5321.MailFrom is empty, the RFC5321.Helo of the forwarder will likely be in different organizational domain of the RFC5322.From. SPF may pass but the alignment with the RFC5322.From header field fails.</li>
</ul>

<p> In either case, SPF cannot produce a DMARC pass, and DKIM will be required to get DMARC to pass. </p>
<h1 id="rfc.section.2.4"><a href="#rfc.section.2.4">2.4.</a> Message Modification</h1>
<p id="rfc.section.2.4.p.1">Modification of email content invalidates most DKIM signatures, and many message forwarding systems modify email content. Mailing list processors are the most common example of such systems, but other forwarding systems also make modifications. Although DKIM provides a length flag so that content can be appended (See Section 8.2 of <a href="#RFC6376">[RFC6376]</a> for additional security considerations), in practice, particularly with <a href="#RFC2045">MIME-encoded</a> <cite title="NONE">[RFC2045]</cite> messages, a mailing list processor will do more than append (See Section 5.3 of <a href="#RFC5598">[RFC5598]</a> for details). Furthermore, the use of the length flag is seldom found in emails in part because of its security challenges.</p>
<p id="rfc.section.2.4.p.2">DKIM has two canonicalizations to use for headers and body separately: simple and relaxed. The latter allows some modest in transit modifications that do not change the interpretation of the content of the email. The relaxed canonicalization is more computing intensive and may not have been preferred in the early deployment of DKIM as this may have been more significant than today.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#IMA_DMARC" id="IMA_DMARC">Internet Mail Architecture, DMARC, and Indirect Email Flows</a></h1>
<p id="rfc.section.3.p.1">This section describes components within the Internet Mail Architecture <a href="#RFC5598">[RFC5598]</a> where interoperability issues between DMARC and indirect email flows can be found.</p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> Message Handling System</h1>
<p id="rfc.section.3.1.p.1">Section 4 of <a href="#RFC5598">[RFC5598]</a> describes six basic components that make up the Message Handling System (MHS): </p>

<ul>
  <li>Message</li>
  <li>Message User Agent (MUA)</li>
  <li>Message Submission Agent (MSA)</li>
  <li>Message Transfer Agent (MTA)</li>
  <li>Message Delivery Agent (MDA)</li>
  <li>Message Store (MS)</li>
</ul>

<p> Of these components MSA, MTA, and MDA are discussed in relation to interoperability with DMARC.</p>
<p id="rfc.section.3.1.p.2">A Mediator is a special class of MUA that is given special consideration in this section due to the unique issues Mediators face when attempting to interoperate with DMARC.</p>
<h1 id="rfc.section.3.1.1"><a href="#rfc.section.3.1.1">3.1.1.</a> Message Submission Agents</h1>
<p id="rfc.section.3.1.1.p.1">An MSA accepts messages submitted by a Message User Agent (MUA) and enforces the policies of the hosting ADministrative Management Domain (ADMD) and the requirements of Internet standards.</p>
<p id="rfc.section.3.1.1.p.2">MSAs are split into two sub-components: </p>

<ul>
  <li>Author-focused MSA functions (aMSA)</li>
  <li>MHS-focused MSA functions (hMSA)</li>
</ul>

<p> </p>
<p id="rfc.section.3.1.1.p.3">MSA interoperability issues with DMARC begin when an aMSA accepts a message where the RFC5322.From header field contains a domain that is outside of the ADMD of the MSA.  The ADMD will almost certainly not be capable of sending email that yields Authenticated Identifiers aligned with the domain found in the RFC5322.From header field.  Examples of this issue include "forward-to-friend" functionality commonly found on news/article websites or "send-as" functionality present on some MUAs.</p>
<p id="rfc.section.3.1.1.p.4">When an hMSA takes responsibility for transit of a message containing a domain in the RFC5322.From header field that is outside of the hMSA's ADMD, the hMSA faces DMARC interoperability issues if the domain publishes a DMARC policy of "quarantine" or "reject".  These issues are marked by an inherent difficulty in establishing alignment with the domain present in a message's RFC5322.From header field.  Examples of this issue include: </p>

<ul>
  <li>Pseudo-open relays - a residential ISP that allows its customers to relay any domains through its infrastructure.</li>
  <li>Embedded devices - cable/dsl modems, firewalls, wireless access points that send email using hardcoded domains.</li>
  <li>Email service providers - ESPs that service customers that are using domains that publish a DMARC "reject" policy.</li>
  <li>Calendaring software - an invited member of an event modifies the event causing calendaring software to emit an update that appears to come from the creator of the event.</li>
</ul>

<p> </p>
<h1 id="rfc.section.3.1.2"><a href="#rfc.section.3.1.2">3.1.2.</a> <a href="#mta" id="mta">Message Transfer Agents</a></h1>
<p id="rfc.section.3.1.2.p.1">MTAs relay a message until the message reaches a destination MDA.</p>
<h1 id="rfc.section.3.1.2.1"><a href="#rfc.section.3.1.2.1">3.1.2.1.</a> Message Encoding</h1>
<p id="rfc.section.3.1.2.1.p.1">An MTA may modify the message encoding, for instance by converting 8-bit MIME sections to quoted-printable 7-bit sections. This modification is outside the scope of DKIM canonicalization and will invalidate DKIM signatures that include message content.</p>
<h1 id="rfc.section.3.1.2.2"><a href="#rfc.section.3.1.2.2">3.1.2.2.</a> Header Standardization</h1>
<p id="rfc.section.3.1.2.2.p.1">An MTA may standardize headers, usually in order to make non-RFC compliant headers properly compliant. For instance, some common MTAs will correct comprehensible but non-compliant date formats to compliant ones. This correction is outside the scope of DKIM canonicalization and will invalidate DKIM signatures. This correction is also outside the scope of this document in providing solutions for non RFC compliant emails.</p>
<h1 id="rfc.section.3.1.2.3"><a href="#rfc.section.3.1.2.3">3.1.2.3.</a> Email Address Internationalization</h1>
<p id="rfc.section.3.1.2.3.p.1">A DMARC related issue may arise in the context of Email Address Internationalization <a href="#RFC6530">[RFC6530]</a>.  <a href="#RFC6854">[RFC6854]</a> allows group syntax in the RFC5322.From header field during the transition period to SMTPUTF8.  If an EAI/SMTPUTF8-aware MTA needs to transmit a message to a non-aware MTA, the non aware MTA will reject it. While an MTA will not downgrade a message. The MUA or MSA may resend the message using the group syntax to allow the non-aware MTA to receive the email.</p>
<p id="rfc.section.3.1.2.3.p.2">In another case, a MDA, may use the group syntax to pass a message to a non EAI/SMTPUTF8-aware MS (or user email client). This message could then be forwarded to another recipient.</p>
<p id="rfc.section.3.1.2.3.p.3">For an MTA, the group syntax may result in the impossibility of finding a domain with a DMARC policy associated with it. If the receiving MTA pays attention to the validity and reputation of domains, this may present its own set of delivery problems. For instance an MTA may refuse emails with no valid or emailable domain in the RFC5322.From as to avoid simple workarounds against DMARC. </p>
<h1 id="rfc.section.3.1.3"><a href="#rfc.section.3.1.3">3.1.3.</a> Message Delivery Agents</h1>
<p id="rfc.section.3.1.3.p.1">The MDA transfers a message from the MHS to a mailbox.  Like the MSA, the MDA consists of two sub-components: </p>

<ul>
  <li>MHS-focused MDA functions (hMDA)</li>
  <li>Recipient-focused MDA functions (rMDA)</li>
</ul>

<p> </p>
<p id="rfc.section.3.1.3.p.2">Both the hMDA and the rMDA can redirect a message to an alternative address.  DMARC interoperability issues related to redirecting of messages are described in <a href="#mediators">Section 3.2</a>.</p>
<p id="rfc.section.3.1.3.p.3">SIEVE <a href="#RFC5228">[RFC5228]</a> functionality often lives in the rMDA sub-component and can cause DMARC interoperability issues. The SIEVE 'addheader' and 'deleteheader' filtering actions can modify messages and invalidate DKIM signatures, removing DKIM-supplied Authenticated Identifiers as inputs to the DMARC mechanism. There are also SIEVE extensions that modify the body. SIEVE may only become an issue when the email is reintroduced in the transport infrastructure.</p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#mediators" id="mediators">Mediators</a></h1>
<p id="rfc.section.3.2.p.1">See <a href="#RFC5598">[RFC5598]</a> for a complete definition of Mediators.</p>
<p id="rfc.section.3.2.p.2">Mediators forward messages through a re-posting process.  Mediators share some functionality with basic MTA relaying, but have greater flexibility in both addressing and content modifications.</p>
<p id="rfc.section.3.2.p.3">DMARC interoperability issues are prevalent within the context of Mediators, which are often used precisely for their ability to modify messages.</p>
<h1 id="rfc.section.3.2.1"><a href="#rfc.section.3.2.1">3.2.1.</a> Alias</h1>
<p id="rfc.section.3.2.1.p.1">An Alias is a simple re-addressing facility that provides one or more new Internet Mail addresses, rather than a single, internal one.  A message continues through the transfer service for delivery to one or more alternative addresses.</p>
<p id="rfc.section.3.2.1.p.2">Aliases can be implemented by mailbox-level forwarding (e.g. through "dot-forwarding") or SIEVE-level forwarding (through the SIEVE 'redirect' action) or other methods.  When an Alias preserves message content and does not make significant header changes, DKIM signatures may remain valid.  However, Aliases often extend the delivery path beyond SPF's ability to grant authorization.</p>
<p id="rfc.section.3.2.1.p.3">Examples of Aliasing include: </p>

<ul>
  <li>Forwarding email between freemail providers to try different interfaces while maintaining an original email address.</li>
  <li>Consolidating many email addresses into a single acccount to centralize processing.</li>
  <li>Services that provides "activity based", "role based" , "vanity" or "temporary" email addresses such as universities and professional associations. For instance professional or alumni institutions may offer to their members an alias for the duration of their membership but may not want to deal with the long term storage of emails.</li>
</ul>

<p> </p>
<p id="rfc.section.3.2.1.p.4">In most cases, the aMSA providing Alias services has no administrative relationship to the ADMD of the final recipient, so solutions to Alias-related DMARC failure should not assume such a relationship.</p>
<h1 id="rfc.section.3.2.2"><a href="#rfc.section.3.2.2">3.2.2.</a> <a href="#resenders" id="resenders">ReSenders</a></h1>
<p id="rfc.section.3.2.2.p.1">ReSenders "splice" a message's addressing information to connect the Author of the original message with the Recipient(s) of the new message.  The new Recipient sees the message as being from the original Author, even if the Mediator adds commentary.</p>
<p id="rfc.section.3.2.2.p.2">ReSenders introduce DMARC interoperability issues as content modification invalidates DKIM signatures.  SPF's ability to grant authorization via alignment is removed as the new Recipient receives the message from the Mediator.</p>
<p id="rfc.section.3.2.2.p.3">Without an ability to produce Authenticated Identifiers relevant to the Author's RFC5322.From header field domain using either DKIM or SPF, the new Recipient has almost no chance of successfully applying the DMARC mechanism.</p>
<p id="rfc.section.3.2.2.p.4">Examples of ReSenders include MUA-level forwarding by resending a message to a new recipient or by forwarding a message "inline" to a new recipient (this does not include forwarding a message "as an attachment").  An additional example comes in the form of calendaring software that allows a meeting attendee (not the meeting organizer) to modify the content of an invite causing the invitations to appear to be reissued from the meeting organizer.</p>
<h1 id="rfc.section.3.2.3"><a href="#rfc.section.3.2.3">3.2.3.</a> Mailing Lists</h1>
<p id="rfc.section.3.2.3.p.1">A Mailing List receives messages as an explicit addressee and then re-posts them to a list of subscribed members.  The Mailing List performs a task that can be viewed as an elaboration of the ReSender.</p>
<p id="rfc.section.3.2.3.p.2">Mailing Lists share the same DMARC interoperability issues as <a href="#resenders">ReSenders</a> <cite title="NONE">[resenders]</cite>, and very commonly modify headers or message content in ways that will cause DKIM to fail, including: </p>

<ul>
  <li>prepending the RFC5322.Subject header field with a tag, to allow the receiver to identify visually the mailing list.</li>
  <li>adding a footer to the email body to contain administrative instructions.</li>
  <li>removing some MIME-parts from the email or converting the message to text only.</li>
  <li>PGP-encrypting or S/MIME encrypting the body to the receiver's key.</li>
  <li>enforcing community standards by rewriting banned words.</li>
  <li>allowing moderators to add arbitrary commentary to messages.</li>
</ul>

<p> Any such modifications would invalidate a DKIM signature.</p>
<p id="rfc.section.3.2.3.p.3">Mailing Lists may also have the following DMARC interoperability issues: </p>

<ul>
  <li>Subscribed members may not receive email from members that post using domains that publish a DMARC "p=reject" policy.</li>
  <li>Mailing Lists may interpret DMARC-related email rejection as an inability to deliver email to the recipients that are checking and enforcing DMARC policy.  This processing may cause subscribed members to be suspended or removed from the Mailing List.</li>
</ul>

<p> </p>
<p id="rfc.section.3.2.3.p.4">These changes are common for many mailing lists and receivers are used to them. Furthermore MUA expects certain mailing list behavior in presenting emails to the end users</p>
<h1 id="rfc.section.3.2.4"><a href="#rfc.section.3.2.4">3.2.4.</a> Gateways</h1>
<p id="rfc.section.3.2.4.p.1">A Gateway performs the basic routing and transfer work of message relaying, but it also is permitted to modify content, structure, address, or attributes as needed to send the message into a messaging environment that operates under different standards or potentially incompatible policies.</p>
<p id="rfc.section.3.2.4.p.2">Gateways share the same DMARC interoperability issues as <a href="#resenders">ReSenders</a> <cite title="NONE">[resenders]</cite>.</p>
<p id="rfc.section.3.2.4.p.3">Gateways may share also the same DMARC interoperability issues as <a href="#mta">MTAs</a> <cite title="NONE">[mta]</cite>.</p>
<p id="rfc.section.3.2.4.p.4">Gateway-level forwarding can introduce DMARC interoperability issues if the Gateway is configured to rewrite the message to map between recipient domains.  For example, an acquisition may lead the acquiring company to decide to decommission the acquired company's domains by rewriting messages to use the domain of the acquiring company. Since the RFC5322.To header field is usually DKIM-signed, this kind of rewriting will also cause DKIM signatures to fail.</p>
<h1 id="rfc.section.3.2.5"><a href="#rfc.section.3.2.5">3.2.5.</a> Boundary Filters</h1>
<p id="rfc.section.3.2.5.p.1">To enforce security boundaries, organizations can subject messages to analysis for conformance with their safety policies.  A filter might alter the content to render it safe, such as by removing content deemed unacceptable.</p>
<p id="rfc.section.3.2.5.p.2">Boundary Filters share the same DMARC interoperability issues as ReSenders.</p>
<p id="rfc.section.3.2.5.p.3">Issues may arise if SPF and DKIM is evaluated after the filter modifications.</p>
<p id="rfc.section.3.2.5.p.4">Examples of Boundary Filters include: </p>

<ul>
  <li>Anti-spam: To keep its reputation, an MTA that transfers a message may remove harmful content from messages that are likely to be unwanted by the next MTA and/or add text in the body to indicate the message has been scanned. Any such modifications would invalidate a DKIM signature.</li>
  <li>Any service that reformulates the RFC5322.body for any other reason, for instance adding an organizational disclaimer.</li>
  <li>Secondary MX services.  In this case, however, it is inappropriate for a primary MX server to perform an SPF check against its own secondaries.  Rather, the secondary MX should perform this function.</li>
</ul>

<p> </p>
<h1 id="rfc.section.3.3"><a href="#rfc.section.3.3">3.3.</a> Combinations</h1>
<p id="rfc.section.3.3.p.1">The causes of indirect email flows can be combined.  For example, a university student may subscribe to a mailing list (using his university email address) while this university email address is configured to forward all emails to a freemail provider where a more permanent email address for this student exists. </p>
<p id="rfc.section.3.3.p.2">Within an organization the message may pass through various <a href="#mta">MTAs</a> <cite title="NONE">[mta]</cite>, each of which performs a different function (authentication, filtering, distribution, etc.) </p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> Possible Mitigations of Interoperability Issues</h1>
<p id="rfc.section.4.p.1">Solutions to interoperability issues between DMARC and indirect email flows vary widely in their scope and implications. They range from improvements to underlying processors, such as proper handling of multiple DKIM signatures, to more radical approaches to the messaging architecture.  This section describes possible ways to address interoperability issues.</p>
<p id="rfc.section.4.p.2">Mail systems are diverse and widely deployed and are expected to continue to work with old systems. For instance, Qmail is still used and the base code has not been updated since 1998. Ezmlm, a once popular mailing list manager, is still deployed and has not been updated since 1997, although a new version, Ezmlm-idx exists. In this constrained environment, some solutions may be time-consuming and/or disruptive to implement.</p>
<p id="rfc.section.4.p.3">DMARC provides for receivers to make decisions about identity alignment acceptability based on information outside DMARC and communicate those decisions as "overrides" to the sender. This facility can be used to ease some interoperability issues, although care is needed to ensure that this does not create loopholes that abusers can use arbitrarily.  </p>
<h1 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> Mitigations in Current Use</h1>
<p id="rfc.section.4.1.p.1">At many places where DMARC is already deployed, mitigations are in use. These mitigations vary in their effectiveness and side effects, but have the advantage that they are currently available.</p>
<h1 id="rfc.section.4.1.1"><a href="#rfc.section.4.1.1">4.1.1.</a> Mitigations for Senders</h1>
<h1 id="rfc.section.4.1.1.1"><a href="#rfc.section.4.1.1.1">4.1.1.1.</a> Identifier Alignment</h1>
<p/>

<ul>
  <li>MTAs handling multiple domains may choose to change RFC5321.MailFrom to align with RFC5322.From to improve SPF usability for DMARC.</li>
  <li>MTAs handling multiple domains may also choose to align RFC5321.HELO/EHLO to RFC5322.From, particularly when sending bounce messages. Adjusting dynamically the RFC5321.HELO based on the RFC5322.From may not be possible for some MTA software.</li>
  <li>MTAs may choose to DKIM sign bounces with an aligned domain to allow DKIM-based DMARC pass.</li>
  <li>MTAs handling multiple domains may require DMARC-using senders to provide DKIM keys and use DKIM to avoid SPF alignment issues. Handling DKIM keys with a third party has its security challenges.</li>
  <li>Senders who are sending on behalf of users in other Administrative Domains may choose to use an RFC5322.From under the sender's control. The new From can be either a forwarding address in a domain controlled by the Sender, or a placeholder address, with the original user's address in a RFC5322.Reply-to header field. However this may affect what the recipient expects in its MUA.</li>
  <li>Senders can use different domains with different DMARC policies for email sent directly and email known to use indirect mail flow. However for known brands, all active domains are likely to be targeted equally by abusers.</li>
</ul>
<h1 id="rfc.section.4.1.1.2"><a href="#rfc.section.4.1.1.2">4.1.1.2.</a> Message Modification</h1>
<p/>

<ul>
  <li>Senders can maximize survivability of DKIM signatures by limiting the header fields they sign, using relaxed canonicalization and by using length to allow appended signatures.</li>
  <li>Senders can also maximize survivability by starting with RFC-compliant headers and common body formats.</li>
  <li>In order to minimize the chances of transport conversions, Senders can convert the message to a suitable MIME content-transfer encoding such as quoted-printable or base64 before signing (<a href="#RFC6376">[RFC6376]</a> Section 5.3). </li>
</ul>

<p> </p>
<h1 id="rfc.section.4.1.2"><a href="#rfc.section.4.1.2">4.1.2.</a> Mitigations for Receivers</h1>
<h1 id="rfc.section.4.1.2.1"><a href="#rfc.section.4.1.2.1">4.1.2.1.</a> Identifier Alignment</h1>
<p/>

<ul>
  <li>Receivers should update DKIM handling libraries to ensure that they process all valid DKIM signatures and check them for alignment.</li>
</ul>
<h1 id="rfc.section.4.1.2.2"><a href="#rfc.section.4.1.2.2">4.1.2.2.</a> Policy Override</h1>
<p/>

<ul>
  <li>Receivers can amalgamate data from their user base to identify forwarders and use such list for a DMARC local policy override. This process may be easier for large receivers, where there is data and resources to create such lists, than for small receivers.</li>
</ul>
<h1 id="rfc.section.4.1.2.3"><a href="#rfc.section.4.1.2.3">4.1.2.3.</a> Email Address Internationalization</h1>
<p/>

<ul>
  <li>During the transition from email systems that do not allow EAI (SMTPUTF8) to email systems that allow it, <a href="#RFC6854">[RFC6854]</a> allows the MUA or MSA to use the group syntax for the RFC5322.From header field to avoid a known MTA to reject the message (if RFC5322 is implemented strictly). While this will alleviate the EAI problem, it will allow a simple DMARC workaround since the message may no longer have a single usable domain in the RFC5322.From header field, making DMARC inapplicable. DMARC implementations that pay attention to the validity of the domains in the RFC5322.From may then have to choose between EAI transitioning compliance (accepting the email without a domain in RFC5322.From) and security (rejecting RFC-compliant email for lack of a domain in the RFC5322.From). The real solution is to upgrade MTAs to support EAI (SMTPUTF8), avoiding the transition issue.</li>
</ul>
<h1 id="rfc.section.4.1.3"><a href="#rfc.section.4.1.3">4.1.3.</a> Mitigations for ReSenders</h1>
<h1 id="rfc.section.4.1.3.1"><a href="#rfc.section.4.1.3.1">4.1.3.1.</a> Changes to the RFC5322.From</h1>
<p id="rfc.section.4.1.3.1.p.1">Many ReSender issues can be avoided by using an RFC5322.From under the ReSender's control, instead of the initial RFC5322.From. This will correct identifier alignment issues and allow arbitrary message modification, for instance. When ReSenders change the RFC5322.From, it is desirable to preserve the information about the original initiator of the message. The <a href="#RFC5703">Original-From</a> <cite title="NONE">[RFC5703]</cite> (or X-Original-From) header field is used for this purpose in various contexts (X- header fields name are discouraged by <a href="#RFC6648">[RFC6648]</a>).</p>
<p id="rfc.section.4.1.3.1.p.2">However, handling of Original-From (or X-Original-From) is not defined anywhere. It is not currently used consistently or displayed to the user, but in any situation where it is used, it is a new unauthenticated identifier available for exploitation.</p>
<h1 id="rfc.section.4.1.3.2"><a href="#rfc.section.4.1.3.2">4.1.3.2.</a> Avoiding Message Modification</h1>
<p/>

<ul>
  <li>Forwarders can choose to add email header fields instead of modifying existing headers or bodies, for instance to indicate a message may be spam.</li>
  <li>Forwarders can minimize the circumstances in which they choose to fix messages, preferring to preserve non-compliant headers to creating DKIM failures.</li>
  <li>Forwarders can choose to reject messages with suspect or harmful content instead of modifying them.</li>
</ul>
<h1 id="rfc.section.4.1.3.3"><a href="#rfc.section.4.1.3.3">4.1.3.3.</a> Mailing Lists</h1>
<p><a href="#RFC6377">[RFC6377]</a> provides some guidance on using DKIM with Mailing lists. Here are some remediation techniques on using DMARC with Mailing lists: </p>

<ul>
  <li>One mitigation policy, which is now present on several Mailing List software, is to configure the Mailing List Manager (MLM) to alter the RFC5322.From header field to use the domain of the MLM. Since most list subscribers prefer to know the identity of the author of the original message, typically this information may be provided in the display name part of the RFC5322.From header field. This display name needs to be carefully crafted as to not collide with the original display name of the author, nor contain something that looks like an email address or domain name. These modifications may to some extent defeat the purpose of DMARC itself. It may make it difficult to ensure that users of all email clients can easily reply to the author, the list, or all using the email client features provided for that purpose. Use of RFC5322.Reply-To header field can alleviate this problem depending on whether the mailing list is configured to reply-to-list, reply-to-author or reply-to-fixed-address, however it is important to note that this header field can take multiple email addresses. When altering the RFC5322.From there are two possibilities, to change it to put the mailing list email address, or to change it to add a suffix like ".invalid" to the domain of the email address present there. The later modification may create issues because it is an invalid domain name, and some MTAs may take particular attention to the validity of email addresses in RFC5322.From and the reputation of the domains present there.</li>
  <li>Another mitigation policy is to configure the MLM to "wrap" the message in a MIME message/rfc822 part and to send as the Mailing List email address. Many email clients (as of August 2014) have difficulty reading such messages. </li>
  <li>Another mitigation policy, is to configure the MLM to not modify the message so that the DKIM signature remains valid. Some Mailing Lists are mainly setup this way and require little modifications to ensure the DKIM signature is preserved. However moving to this policy a list that do extensive modification to the email, may be too much of a change for the members of such list.</li>
  <li>Another mitigation policy, is to reject posts from domains with a DMARC policy other than p=none. However members of such  Mailing  Lists may complain of unfair exclusion.</li>
  <li>To alleviate unsubscribes to the Mailing List due to the messages bouncing because of DMARC, the MLM needs to not act on bounces due to Message Authentication issues. <a href="#RFC3463">[RFC3463]</a> specifies Enhanced Mail System Status Codes which help differentiate between various bounces. Correctly interpreting Extended SMTP error messages is useful in this case in particular codes defined in <a href="#RFC7372">[RFC7372]</a> and in DMARC.</li>
</ul>

<p> All these techniques may provide some specific challenges in MUAs and different operational usages for end users (like rewriting filters to sort emails in folders). There will be some time before all implications are understood and alleviated. </p>
<h1 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> Proposed and In-Progress Mitigations</h1>
<p id="rfc.section.4.2.p.1">The following mitigations are based on Internet Drafts which have not yet received broad consensus. They are described here to offer exploratory path for solutions. These solutions should not be used in a production environment.  </p>

<ul>
  <li>Third party authorization, <a href="#RFC6541">[RFC6541]</a>, <a href="#I-D.otis-tpa-label">[I-D.otis-tpa-label]</a> and <a href="#I-D.kucherawy-dkim-delegate">[I-D.kucherawy-dkim-delegate]</a> provide ways to extend identifier alignment under the control of the domain owner.</li>
  <li>DKIM with constrained transformations, <a href="#I-D.kucherawy-dkim-list-canon">[I-D.kucherawy-dkim-list-canon]</a> is proposed to allow message modification.</li>
  <li>DKIM with recorded transformations, <a href="#I-D.kucherawy-dkim-transform">[I-D.kucherawy-dkim-transform]</a> is proposed to indicate what limited transformations were done to the message so that a receiver could reverse them and confirm the validity of the orignal DKIM signature.</li>
  <li><a href="#I-D.kucherawy-original-authres">[I-D.kucherawy-original-authres]</a> is intended as a way to pass along Original Authentication Results to "downstream" receivers. It is not widely implemented and relies on a trust relationship between the forwarder and the other receivers.</li>
  <li><a href="#I-D.levine-dkim-conditional">[I-D.levine-dkim-conditional]</a> could be used to have the sender add a limited DKIM signature, that signs only a very limited set of header fields and not the body of the message. This DKIM signature would come with the condition that a subsequent known domain fully DKIM sign the message. For instance a Mailing List could transform the message, add its DKIM signature and there would be a valid DKIM signature aligned with the RFC5322.From that would satisfy DMARC while limiting the possibilities of replay attack.</li>
</ul>

<p> </p>
<h1 id="rfc.section.4.2.1"><a href="#rfc.section.4.2.1">4.2.1.</a> Getting More Radical: Requiring New Communication Paths Between MUAs</h1>
<p id="rfc.section.4.2.1.p.1">In practice a number of operators are using strict alignment mode in DMARC in order to avoid receiving new and innovative forms of unwanted and unauthentic email through systems purporting to be mailing list handlers.  The receiving ADMD has no knowledge of which lists the user has subscribed to and which they have not.  One avenue of exploration would be for the user to authorize mailing lists as proxies for authentication, at which point the receiving ADMD would be vesting some trust in the mailing list service.  The creators of DKIM foresaw precisely this possibility at the time by not tightly binding any semantics to the RFC5322.From header field.  Some experimental work has taken place in this area, as mentioned above.  Additional work might examine a new communication path to the user to authorize some form of transitive trust.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#IANA" id="IANA">IANA Considerations</a></h1>
<p id="rfc.section.5.p.1">This document contains no actions for IANA.  [RFC Editor: Please delete this section prior to publication.]</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#Security" id="Security">Security Considerations</a></h1>
<p id="rfc.section.6.p.1">This document is an analysis of DMARC's impact on indirect email flows.  It describes the possibility of accidental denial-of-service that can be created by rejections of messages by DMARC-aware Mail Receivers.  However, it introduces no new security issues to Internet messaging.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#ack" id="ack">Acknowledgments</a></h1>
<p id="rfc.section.7.p.1">Miles Fidelman, John Levine, David Crocker, Stephen J. Turnbull, Rolf E. Sonneveld, Tim Draegen and Franck Martin contributed to the IETF DMARC Working Group's wiki page listing all known interoperability issues with DMARC and indirect email flows.</p>
<p id="rfc.section.7.p.2">Tim Draegen created the first draft of this document from these contributions and by hamfistedly mapping contributions into the language of <a href="#RFC5598">[RFC5598]</a>.</p>
<h1 id="rfc.references"><a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC2045">[RFC2045]</b>
      </td>
      <td class="top"><a href="mailto:ned@innosoft.com" title="Innosoft International, Inc.">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com" title="First Virtual Holdings">N. Borenstein</a>, "<a href="http://tools.ietf.org/html/rfc2045">Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>", RFC 2045, November 1996.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3463">[RFC3463]</b>
      </td>
      <td class="top"><a>Vaudreuil, G.</a>, "<a href="http://tools.ietf.org/html/rfc3463">Enhanced Mail System Status Codes</a>", RFC 3463, January 2003.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5228">[RFC5228]</b>
      </td>
      <td class="top"><a>Guenther, P.</a> and <a>T. Showalter</a>, "<a href="http://tools.ietf.org/html/rfc5228">Sieve: An Email Filtering Language</a>", RFC 5228, January 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5321">[RFC5321]</b>
      </td>
      <td class="top"><a>Klensin, J.</a>, "<a href="http://tools.ietf.org/html/rfc5321">Simple Mail Transfer Protocol</a>", RFC 5321, October 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5322">[RFC5322]</b>
      </td>
      <td class="top"><a href="mailto:presnick@qualcomm.com" title="Qualcomm Incorporated">Resnick, P.</a>, "<a href="http://tools.ietf.org/html/rfc5322">Internet Message Format</a>", RFC 5322, October 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5598">[RFC5598]</b>
      </td>
      <td class="top"><a>Crocker, D.</a>, "<a href="http://tools.ietf.org/html/rfc5598">Internet Mail Architecture</a>", RFC 5598, July 2009.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5703">[RFC5703]</b>
      </td>
      <td class="top"><a>Hansen, T.</a> and <a>C. Daboo</a>, "<a href="http://tools.ietf.org/html/rfc5703">Sieve Email Filtering: MIME Part Tests, Iteration, Extraction, Replacement, and Enclosure</a>", RFC 5703, October 2009.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6376">[RFC6376]</b>
      </td>
      <td class="top"><a>Crocker, D.</a>, <a>Hansen, T.</a> and <a>M. Kucherawy</a>, "<a href="http://tools.ietf.org/html/rfc6376">DomainKeys Identified Mail (DKIM) Signatures</a>", STD 76, RFC 6376, September 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6377">[RFC6377]</b>
      </td>
      <td class="top"><a>Kucherawy, M.</a>, "<a href="http://tools.ietf.org/html/rfc6377">DomainKeys Identified Mail (DKIM) and Mailing Lists</a>", BCP 167, RFC 6377, September 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6530">[RFC6530]</b>
      </td>
      <td class="top"><a>Klensin, J.</a> and <a>Y. Ko</a>, "<a href="http://tools.ietf.org/html/rfc6530">Overview and Framework for Internationalized Email</a>", RFC 6530, February 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6541">[RFC6541]</b>
      </td>
      <td class="top"><a>Kucherawy, M.</a>, "<a href="http://tools.ietf.org/html/rfc6541">DomainKeys Identified Mail (DKIM) Authorized Third-Party Signatures</a>", RFC 6541, February 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6648">[RFC6648]</b>
      </td>
      <td class="top"><a>Saint-Andre, P.</a>, <a>Crocker, D.</a> and <a>M. Nottingham</a>, "<a href="http://tools.ietf.org/html/rfc6648">Deprecating the "X-" Prefix and Similar Constructs in Application Protocols</a>", BCP 178, RFC 6648, June 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6854">[RFC6854]</b>
      </td>
      <td class="top"><a>Leiba, B.</a>, "<a href="http://tools.ietf.org/html/rfc6854">Update to Internet Message Format to Allow Group Syntax in the "From:" and "Sender:" Header Fields</a>", RFC 6854, March 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7208">[RFC7208]</b>
      </td>
      <td class="top"><a>Kitterman, S.</a>, "<a href="http://tools.ietf.org/html/rfc7208">Sender Policy Framework (SPF) for Authorizing Use of Domains in Email, Version 1</a>", RFC 7208, April 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7372">[RFC7372]</b>
      </td>
      <td class="top"><a>Kucherawy, M.</a>, "<a href="http://tools.ietf.org/html/rfc7372">Email Authentication Status Codes</a>", RFC 7372, September 2014.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.kucherawy-dkim-delegate">[I-D.kucherawy-dkim-delegate]</b>
      </td>
      <td class="top"><a>Kucherawy, M.</a> and <a>D. Crocker</a>, "<a href="http://tools.ietf.org/html/draft-kucherawy-dkim-delegate-01">Delegating DKIM Signing Authority</a>", Internet-Draft draft-kucherawy-dkim-delegate-01, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.kucherawy-dkim-list-canon">[I-D.kucherawy-dkim-list-canon]</b>
      </td>
      <td class="top"><a>Kucherawy, M.</a>, "<a href="http://tools.ietf.org/html/draft-kucherawy-dkim-list-canon-00">A List-safe Canonicalization for DomainKeys Identified Mail (DKIM)</a>", Internet-Draft draft-kucherawy-dkim-list-canon-00, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.kucherawy-dkim-transform">[I-D.kucherawy-dkim-transform]</b>
      </td>
      <td class="top"><a>Kucherawy, M.</a>, "<a href="http://tools.ietf.org/html/draft-kucherawy-dkim-transform-00">Recognized Transformations of Messages Bearing DomainKeys Identified Mail (DKIM) Signatures</a>", Internet-Draft draft-kucherawy-dkim-transform-00, April 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.kucherawy-original-authres">[I-D.kucherawy-original-authres]</b>
      </td>
      <td class="top"><a>Chew, M.</a> and <a>M. Kucherawy</a>, "<a href="http://tools.ietf.org/html/draft-kucherawy-original-authres-00">Original-Authentication-Results Header Field</a>", Internet-Draft draft-kucherawy-original-authres-00, February 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.levine-dkim-conditional">[I-D.levine-dkim-conditional]</b>
      </td>
      <td class="top"><a>Levine, J.</a>, "<a href="http://tools.ietf.org/html/draft-levine-dkim-conditional-00">DKIM Conditional Signatures</a>", Internet-Draft draft-levine-dkim-conditional-00, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.otis-tpa-label">[I-D.otis-tpa-label]</b>
      </td>
      <td class="top"><a>Otis, D.</a> and <a>D. Black</a>, "<a href="http://tools.ietf.org/html/draft-otis-tpa-label-00">Third-Party Authorization Label</a>", Internet-Draft draft-otis-tpa-label-00, May 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7489">[RFC7489]</b>
      </td>
      <td class="top"><a>Kucherawy, M.</a> and <a>E. Zwicky</a>, "<a href="http://tools.ietf.org/html/rfc7489">Domain-based Message Authentication, Reporting, and Conformance (DMARC)</a>", RFC 7489, March 2015.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Franck Martin</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Martin</span>
	  </span>
	</span>
	<span class="org vcardline">LinkedIn</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Mountain View</span>,  
		<span class="region">CA</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:fmartin@linkedin.com">fmartin@linkedin.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Eliot Lear</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Lear</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems GmbH</span>
	<span class="adr">
	  <span class="vcardline">Richtistrasse 7</span>

	  <span class="vcardline">
		<span class="locality">Wallisellen</span>,  
		<span class="region">ZH</span> 
		<span class="code">CH-8304</span>
	  </span>
	  <span class="country-name vcardline">Switzerland</span>
	</span>
	<span class="vcardline">Phone: +41 44 878 9200</span>

<span class="vcardline">EMail: <a href="mailto:lear@cisco.com">lear@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Tim Draegen</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Draegen</span>
	  </span>
	</span>
	<span class="org vcardline">Eudaemonic Development LLC</span>
	<span class="adr">
	  <span class="vcardline">PO Box 19443</span>

	  <span class="vcardline">
		<span class="locality">Asheville</span>,  
		<span class="region">NC</span> 
		<span class="code">28815</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:tim@eudev.net">tim@eudev.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Elizabeth Zwicky</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Zwicky</span>
	  </span>
	</span>
	<span class="org vcardline">Yahoo</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Sunnyvale</span>,  
		<span class="region">CA</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:zwicky@yahoo-inc.com">zwicky@yahoo-inc.com</a></span>

  </address>
</div>

</body>
</html>
