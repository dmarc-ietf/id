<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Interoperability Issues Between DMARC and Indirect Email Flows</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Document Conventions"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Causes of Interoperability Issues"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Identifier Alignment"/>
<link href="#rfc.section.2.1.1" rel="Chapter" title="2.1.1 DKIM Identifier(s)"/>
<link href="#rfc.section.2.1.2" rel="Chapter" title="2.1.2 SPF Identifier(s)"/>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Message Forwarding"/>
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Message Modification"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Internet Mail Architecture, DMARC, and Indirect Email Flows"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Message Handling System"/>
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 Message Submission Agents"/>
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 Message Transfer Agents"/>
<link href="#rfc.section.3.1.2.1" rel="Chapter" title="3.1.2.1 Message Encoding"/>
<link href="#rfc.section.3.1.2.2" rel="Chapter" title="3.1.2.2 Header Standardization"/>
<link href="#rfc.section.3.1.2.3" rel="Chapter" title="3.1.2.3 Content Validation"/>
<link href="#rfc.section.3.1.3" rel="Chapter" title="3.1.3 Message Delivery Agents"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Mediators"/>
<link href="#rfc.section.3.2.1" rel="Chapter" title="3.2.1 Alias"/>
<link href="#rfc.section.3.2.2" rel="Chapter" title="3.2.2 ReSenders"/>
<link href="#rfc.section.3.2.3" rel="Chapter" title="3.2.3 Mailing Lists"/>
<link href="#rfc.section.3.2.3.1" rel="Chapter" title="3.2.3.1 Mailing List Operational Effects"/>
<link href="#rfc.section.3.2.4" rel="Chapter" title="3.2.4 Gateways"/>
<link href="#rfc.section.3.2.5" rel="Chapter" title="3.2.5 Boundary Filters"/>
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Combinations"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Possible Mitigations of Interoperability Issues"/>
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Mitigations in Current Use"/>
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 Mitigations for Senders"/>
<link href="#rfc.section.4.1.1.1" rel="Chapter" title="4.1.1.1 Identifier Alignment"/>
<link href="#rfc.section.4.1.1.2" rel="Chapter" title="4.1.1.2 Message Modification"/>
<link href="#rfc.section.4.1.2" rel="Chapter" title="4.1.2 Mitigations for Receivers"/>
<link href="#rfc.section.4.1.2.1" rel="Chapter" title="4.1.2.1 Identifier Alignment"/>
<link href="#rfc.section.4.1.2.2" rel="Chapter" title="4.1.2.2 Policy Override"/>
<link href="#rfc.section.4.1.3" rel="Chapter" title="4.1.3 Mitigations for ReSenders"/>
<link href="#rfc.section.4.1.3.1" rel="Chapter" title="4.1.3.1 Changes to the RFC5322.from"/>
<link href="#rfc.section.4.1.3.2" rel="Chapter" title="4.1.3.2 Avoiding Message Modification"/>
<link href="#rfc.section.4.1.3.3" rel="Chapter" title="4.1.3.3 Mailing Lists"/>
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Proposed and In-Progress Mitigations"/>
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 Getting More Radical: Requiring New Communication Paths Between MUAs"/>
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgments"/>
<link href="#rfc.references" rel="Chapter" title="8 References"/>
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.0 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Martin, F., Ed., Lear, E., Ed., Draegen, T., Ed., Zwicky, E., Ed., and K. Andersen, Ed." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-dmarc-interoperability-12" />
  <meta name="dct.issued" scheme="ISO8601" content="2015-11" />
  <meta name="dct.abstract" content="DMARC introduces a mechanism for expressing domain-level policies and preferences for email message validation, disposition, and reporting.  The DMARC mechanism can encounter interoperability issues when messages do not flow directly from the author's administrative domain to the final recipients. Collectively these email flows are referred to as indirect email flows.  This document describes interoperability issues between DMARC and indirect email flows. Possible methods for addressing interoperability issues are presented." />
  <meta name="description" content="DMARC introduces a mechanism for expressing domain-level policies and preferences for email message validation, disposition, and reporting.  The DMARC mechanism can encounter interoperability issues when messages do not flow directly from the author's administrative domain to the final recipients. Collectively these email flows are referred to as indirect email flows.  This document describes interoperability issues between DMARC and indirect email flows. Possible methods for addressing interoperability issues are presented." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">DMARC</td>
  <td class="right">F. Martin, Ed.</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">LinkedIn</td>
</tr>
<tr>
  <td class="left">Intended status: Informational</td>
  <td class="right">E. Lear, Ed.</td>
</tr>
<tr>
  <td class="left">Expires: May 4, 2016</td>
  <td class="right">Cisco Systems GmbH</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">T. Draegen, Ed.</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">dmarcian, inc.</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">E. Zwicky, Ed.</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Yahoo</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">K. Andersen, Ed.</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">LinkedIn</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">November 2015</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Interoperability Issues Between DMARC and Indirect Email Flows<br />
  <span class="filename">draft-ietf-dmarc-interoperability-12</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>DMARC introduces a mechanism for expressing domain-level policies and preferences for email message validation, disposition, and reporting.  The DMARC mechanism can encounter interoperability issues when messages do not flow directly from the author's administrative domain to the final recipients. Collectively these email flows are referred to as indirect email flows.  This document describes interoperability issues between DMARC and indirect email flows. Possible methods for addressing interoperability issues are presented.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 4, 2016.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2015 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Document Conventions</a></li>
</ul><li>2.   <a href="#rfc.section.2">Causes of Interoperability Issues</a></li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Identifier Alignment</a></li>
<ul><li>2.1.1.   <a href="#rfc.section.2.1.1">DKIM Identifier(s)</a></li>
<li>2.1.2.   <a href="#rfc.section.2.1.2">SPF Identifier(s)</a></li>
</ul><li>2.2.   <a href="#rfc.section.2.2">Message Forwarding</a></li>
<li>2.3.   <a href="#rfc.section.2.3">Message Modification</a></li>
</ul><li>3.   <a href="#rfc.section.3">Internet Mail Architecture, DMARC, and Indirect Email Flows</a></li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Message Handling System</a></li>
<ul><li>3.1.1.   <a href="#rfc.section.3.1.1">Message Submission Agents</a></li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">Message Transfer Agents</a></li>
<ul><li>3.1.2.1.   <a href="#rfc.section.3.1.2.1">Message Encoding</a></li>
<li>3.1.2.2.   <a href="#rfc.section.3.1.2.2">Header Standardization</a></li>
<li>3.1.2.3.   <a href="#rfc.section.3.1.2.3">Content Validation</a></li>
</ul><li>3.1.3.   <a href="#rfc.section.3.1.3">Message Delivery Agents</a></li>
</ul><li>3.2.   <a href="#rfc.section.3.2">Mediators</a></li>
<ul><li>3.2.1.   <a href="#rfc.section.3.2.1">Alias</a></li>
<li>3.2.2.   <a href="#rfc.section.3.2.2">ReSenders</a></li>
<li>3.2.3.   <a href="#rfc.section.3.2.3">Mailing Lists</a></li>
<ul><li>3.2.3.1.   <a href="#rfc.section.3.2.3.1">Mailing List Operational Effects</a></li>
</ul><li>3.2.4.   <a href="#rfc.section.3.2.4">Gateways</a></li>
<li>3.2.5.   <a href="#rfc.section.3.2.5">Boundary Filters</a></li>
</ul><li>3.3.   <a href="#rfc.section.3.3">Combinations</a></li>
</ul><li>4.   <a href="#rfc.section.4">Possible Mitigations of Interoperability Issues</a></li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Mitigations in Current Use</a></li>
<ul><li>4.1.1.   <a href="#rfc.section.4.1.1">Mitigations for Senders</a></li>
<ul><li>4.1.1.1.   <a href="#rfc.section.4.1.1.1">Identifier Alignment</a></li>
<li>4.1.1.2.   <a href="#rfc.section.4.1.1.2">Message Modification</a></li>
</ul><li>4.1.2.   <a href="#rfc.section.4.1.2">Mitigations for Receivers</a></li>
<ul><li>4.1.2.1.   <a href="#rfc.section.4.1.2.1">Identifier Alignment</a></li>
<li>4.1.2.2.   <a href="#rfc.section.4.1.2.2">Policy Override</a></li>
</ul><li>4.1.3.   <a href="#rfc.section.4.1.3">Mitigations for ReSenders</a></li>
<ul><li>4.1.3.1.   <a href="#rfc.section.4.1.3.1">Changes to the RFC5322.from</a></li>
<li>4.1.3.2.   <a href="#rfc.section.4.1.3.2">Avoiding Message Modification</a></li>
<li>4.1.3.3.   <a href="#rfc.section.4.1.3.3">Mailing Lists</a></li>
</ul></ul><li>4.2.   <a href="#rfc.section.4.2">Proposed and In-Progress Mitigations</a></li>
<ul><li>4.2.1.   <a href="#rfc.section.4.2.1">Getting More Radical: Requiring New Communication Paths Between MUAs</a></li>
</ul></ul><li>5.   <a href="#rfc.section.5">IANA Considerations</a></li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a></li>
<li>7.   <a href="#rfc.section.7">Acknowledgments</a></li>
<li>8.   <a href="#rfc.references">References</a></li>
<ul><li>8.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> Introduction</h1>
<p><a href="#RFC7489">DMARC</a> <cite title="NONE">[RFC7489]</cite> introduces a mechanism for expressing domain-level policies and preferences for message validation, disposition, and reporting.  The DMARC mechanism can encounter several different types of interoperability issues due to third-party message sourcing, message transformation or rerouting.</p>
<p id="rfc.section.1.p.2">At the time of the writing of this document, the DMARC base specification is published as Informational <a href="#RFC7489">RFC7489</a> <cite title="NONE">[RFC7489]</cite> and has seen significant deployment within the email community.</p>
<p id="rfc.section.1.p.3">Cases in which email does not flow directly from the author's administrative domain to the recipient's domain(s) are collectively referred to in this document as indirect email flows.  Due to existing and increasing adoption of DMARC, the impact of DMARC-based email rejection policies on indirect email flows can be significant for a select subset of general email traffic. </p>
<p id="rfc.section.1.p.4">Several known causes of interoperability issues are presented, followed by a description of components within the Internet Mail Architecture <a href="#RFC5598">[RFC5598]</a> where interoperability issues can arise.</p>
<p id="rfc.section.1.p.5">Finally, known and possible methods for addressing interoperability issues are presented.  There are often multiple ways to address any given interoperability issue.  While this document strives to be comprehensive in its review, it should not be treated as complete. Also, some practices which are in use at the time of this document may or may not be "best practices" as future standards evolve.</p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> Document Conventions</h1>
<p id="rfc.section.1.1.p.1">Notation regarding structured fields is taken from <a href="#RFC5598">[RFC5598]</a>.</p>
<p id="rfc.section.1.1.p.2">Organizational Domain and Authenticated Identifiers are specified in <a href="#RFC7489">DMARC</a> <cite title="NONE">[RFC7489]</cite>.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> Causes of Interoperability Issues</h1>
<p id="rfc.section.2.p.1">Interoperability issues between DMARC and indirect email flows arise when conformance to the DMARC specification leads a receiving implementation to apply DMARC based policy restrictions to messages that are both compliant with the architecture as specified in <a href="#RFC5598">[RFC5598]</a> and viewed as legitimate by the intended recipient.</p>
<p id="rfc.section.2.p.2">Note that domains which assert a "p=none" policy and email which passes standard DMARC validation do not have any interoperability issues.</p>
<p id="rfc.section.2.p.3">Email messages that do not conform to IETF email specifications but are considered legitimate by the intended recipients are not discussed in this document. The rest of this section describes several conceptual causes of interoperability issues.</p>
<h1 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> Identifier Alignment</h1>
<p id="rfc.section.2.1.p.1">DMARC relies on <a href="#RFC6376">DKIM</a> <cite title="NONE">[RFC6376]</cite> and <a href="#RFC7208">SPF</a> <cite title="NONE">[RFC7208]</cite> to perform message source validation.  The <a href="#RFC7489">DMARC</a> <cite title="NONE">[RFC7489]</cite> mechanism refers to source domains that are validated by DKIM or SPF as Authenticated Identifiers.  DMARC requires an Authenticated Identifier to be related to the domain found in the message's RFC5322.from header field <a href="#RFC5322">[RFC5322]</a>. This relationship is referred to as Identifier Alignment.</p>
<p id="rfc.section.2.1.p.2">DMARC allows for Identifier Alignment to be achieved in two different modes: strict and relaxed. Strict mode requires an exact match of either of the Authenticated Identifiers to the message's RFC5322.from header field <a href="#RFC5322">[RFC5322]</a>. Relaxed mode allows for Identifier Alignment if Authenticated Identifiers and the message's RFC5322.from header field <a href="#RFC5322">[RFC5322]</a> share the same Organizational Domain. In general, interoperability issues between strict and relaxed modes are the same, with strict mode constraining the application of possible solutions. The mitigations described in this document generally require a relaxed mode of Identifier Alignment.</p>
<h1 id="rfc.section.2.1.1"><a href="#rfc.section.2.1.1">2.1.1.</a> DKIM Identifier(s)</h1>
<p id="rfc.section.2.1.1.p.1">DKIM provides a cryptographic means for one or more domain identifier to be associated with a particular message. As a standalone technology DKIM identifiers are not required to be relevant to the content of a message. However, for a DKIM identifier to align in DMARC, the signing domain of a valid signature must be part of the same Organizational Domain as the domain in the RFC5322.from header field <a href="#RFC5322">[RFC5322]</a>. </p>
<p id="rfc.section.2.1.1.p.2">In addition, DKIM allows for the possibility of multiple valid signatures.  The DMARC mechanism will process Authenticated Identifiers that are based on DKIM signatures until an aligned Authenticated Identifier is found (if any). However, operational experience has shown that some implementations have difficulty processing multiple signatures.  The impact on DMARC processing is clear: implementations that cannot process multiple DKIM signatures may incorrectly flag messages as "failing DMARC" and erroneously apply DMARC based policy to otherwise conforming messages. </p>
<h1 id="rfc.section.2.1.2"><a href="#rfc.section.2.1.2">2.1.2.</a> SPF Identifier(s)</h1>
<p id="rfc.section.2.1.2.p.1">The <a href="#RFC7208">SPF specification</a> <cite title="NONE">[RFC7208]</cite> defines two Authenticated Identifiers for each message. These identifiers derive from: </p>

<ol style="list-style-type: lower-alpha">
  <li>the <a href="#RFC5321">RFC5321.mailfrom</a> <cite title="NONE">[RFC5321]</cite> domain, and</li>
  <li>the RFC5321.HELO/EHLO SMTP domain.</li>
</ol>
<p id="rfc.section.2.1.2.p.2">In the SPF specification, the <a href="#RFC7208">RFC7208.MAILFROM</a> <cite title="NONE">[RFC7208]</cite> value is defined to be based on RFC5321.mailfrom unless that value is absent (as in the case of "bounce" messages) in which case, the second (RFC5321.HELO/EHLO) identifier value is used. This "fallback" definition has occasionally been misunderstood by senders since "bounce" messages are often an "automatic" feature of MTA software.</p>
<p id="rfc.section.2.1.2.p.3">For the purposes of DMARC validation/alignment, the hybrid <a href="#RFC7208">RFC7208.MAILFROM</a> <cite title="NONE">[RFC7208]</cite> identifier's domain is used if, and only if, it is aligned with the <a href="#RFC5322">RFC5322.from</a> <cite title="NONE">[RFC5322]</cite> domain. The alignment of the validated domain is determined based on the DMARC record's "strict" or "relaxed" designation as described above for the DKIM identifiers and in <a href="#RFC7489">[RFC7489]</a>.</p>
<h1 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> Message Forwarding</h1>
<p><a href="#IMA_DMARC">Section 3</a> describes forwarding behavior as it relates to the components of the Internet Mail Architecture.</p>
<p id="rfc.section.2.2.p.2">All forwarding behavior involves the retransmission of email. As discussed above, in order for SPF to yield an Authenticated Identifier that is pertinent to DMARC, the domain of the RFC7208.MAILFROM must be in alignment with the RFC5322.from header field.  Forwarding introduces specific issues to the availability of SPF-based Authenticated Identifiers: </p>

<ul>
  <li>If the RFC5321.mailfrom is present and the forwarder maintains the original RFC5321.mailfrom, SPF validation will fail unless the forwarder is an authorized part of the originator's email sending infrastructure. If the forwarder replaces the RFC5321.mailfrom with its own domain, SPF might pass but Identifier Alignment with the RFC5322.from header field will fail.</li>
  <li>If the RFC5321.mailfrom is empty (as in the case of Delivery Status Notifications), the RFC5321.Helo domain of the forwarder will likely be in different organizational domain than the orignal RFC5322.from header field's domain. SPF may pass but Identifier Alignment with the RFC5322.from header field will fail.</li>
</ul>

<p> In both cases, SPF cannot yield relevant Authenticated Identifiers, and DKIM must be relied upon to produce results that are relevant to DMARC. </p>
<h1 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a> Message Modification</h1>
<p id="rfc.section.2.3.p.1">Modification of email content invalidates most DKIM signatures, and many message forwarding systems modify email content. Mailing list processors are a common example of such systems, but other forwarding systems also make modifications.</p>
<p id="rfc.section.2.3.p.2">Although DKIM provides a length flag so that content can be appended without invalidating the signature, in practice, particularly with <a href="#RFC2045">MIME-encoded</a> <cite title="NONE">[RFC2045]</cite> messages, a mailing list processor will do more than simply append content (see Section 5.3 of <a href="#RFC5598">[RFC5598]</a> for details). Furthermore, the length flag is seldom used due to security issues (see Section 8.2 of <a href="#RFC6376">[RFC6376]</a> for additional security considerations), therefore, this method is only here mentioned for completeness.</p>
<p id="rfc.section.2.3.p.3">DKIM describes two canonicalizations for use when preparing header and body for DKIM processing: simple and relaxed. The latter allows for trivial modifications (largely regarding whitespace and folding) that maintain the integrity of the content of the email. However, the relaxed canonicalization is more computationally intensive and may not have been preferred in the early deployment of DKIM, leaving some deployments using the less forgiving "simple" canonicalization. While the prevalence is unknown, there are some DKIM verifiers which have problems evaluating relaxed canonicalization correctly.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#IMA_DMARC" id="IMA_DMARC">Internet Mail Architecture, DMARC, and Indirect Email Flows</a></h1>
<p id="rfc.section.3.p.1">This section describes components within the Internet Mail Architecture <a href="#RFC5598">[RFC5598]</a> where interoperability issues between DMARC and indirect email flows can be found.</p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> Message Handling System</h1>
<p id="rfc.section.3.1.p.1">Section 4 of <a href="#RFC5598">[RFC5598]</a> describes six basic components that make up the Message Handling System (MHS): </p>

<ul>
  <li>Message</li>
  <li>Message User Agent (MUA)</li>
  <li>Message Submission Agent (MSA)</li>
  <li>Message Transfer Agent (MTA)</li>
  <li>Message Delivery Agent (MDA)</li>
  <li>Message Store (MS)</li>
</ul>

<p> Of these components MSA, MTA, and MDA are discussed in relation to interoperability with DMARC.</p>
<p><a href="#RFC5598">[RFC5598]</a> Section 5 also defines a Mediator is a hybrid of several component types.  A Mediator is given special consideration in this section due to the unique issues they face when attempting to interoperate with DMARC.</p>
<h1 id="rfc.section.3.1.1"><a href="#rfc.section.3.1.1">3.1.1.</a> Message Submission Agents</h1>
<p id="rfc.section.3.1.1.p.1">An MSA accepts messages submitted by a Message User Agent (MUA) and enforces the policies of the hosting ADministrative Management Domain (ADMD) and the requirements of Internet standards.</p>
<p id="rfc.section.3.1.1.p.2">MSAs are split into two sub-components: </p>

<ul>
  <li>Author-focused MSA functions (aMSA)</li>
  <li>MHS-focused MSA functions (hMSA)</li>
</ul>

<p> </p>
<p id="rfc.section.3.1.1.p.3">MSA interoperability issues with DMARC begin when an aMSA accepts a message where the RFC5322.from header field contains a domain that is outside of the ADMD of the MSA.  These issues manifest themselves in one of several ways, such as when someone uses a mail service with their own domain but has failed to properly configure an SPF record; or when an MUA attempts to transmit mail as someone else.  Examples of the latter issue include "forward-to-friend" functionality commonly found on news/article websites or "send-as" functionality present on some MUAs.</p>
<p id="rfc.section.3.1.1.p.4">When an hMSA takes responsibility for transit of a message containing a domain in the RFC5322.from header field that is outside of the hMSA's ADMD, the hMSA faces DMARC interoperability issues if the domain publishes a DMARC policy of "quarantine" or "reject".  These issues are marked by the inherent difficulty of establishing alignment with the domain present in a message's RFC5322.from header field.  Examples of this issue include: </p>

<ul>
  <li>Pseudo-open relays - a residential ISP that allows its customers to relay non-local domains through its infrastructure.</li>
  <li>Embedded devices - cable/DSL modems, firewalls, wireless access points, printers that send email using hardcoded domains.</li>
  <li>Devices that send mail on behalf of a user - scanners, security cameras, alarms that send mail as their owner or a device user.</li>
  <li>Email service providers - ESPs that service customers who are using domains that publish a DMARC "reject" policy.</li>
  <li>Calendaring software - an invited member of an event modifies the event causing calendaring software to emit an update that claims to come from the creator of the event.</li>
</ul>

<p> </p>
<h1 id="rfc.section.3.1.2"><a href="#rfc.section.3.1.2">3.1.2.</a> <a href="#mta" id="mta">Message Transfer Agents</a></h1>
<p id="rfc.section.3.1.2.p.1">MTAs relay a message until the message reaches a destination MDA. As such, they are in a position to introduce interoperability problems.</p>
<h1 id="rfc.section.3.1.2.1"><a href="#rfc.section.3.1.2.1">3.1.2.1.</a> Message Encoding</h1>
<p id="rfc.section.3.1.2.1.p.1">An MTA may modify the message encoding, for instance by converting 8-bit MIME sections to quoted-printable 7-bit sections. This modification is outside the scope of DKIM canonicalization and will invalidate DKIM signatures that include message content.</p>
<p id="rfc.section.3.1.2.1.p.2">An MTA could also re-encode the message without changing the encoding type, receiving a MIME-encoded message and producing a semantically and syntactically equivalent MIME body that is not identical to the original. This is characteristic of systems that use some other message representation internally.</p>
<h1 id="rfc.section.3.1.2.2"><a href="#rfc.section.3.1.2.2">3.1.2.2.</a> Header Standardization</h1>
<p id="rfc.section.3.1.2.2.p.1">An MTA may rewrite headers to bring them into compliance with existing RFCs. For example, some common MTAs will correct comprehensible but non-compliant date formats to compliant ones.</p>
<p id="rfc.section.3.1.2.2.p.2">Header rewriting is outside the scope of DKIM canonicalization and will invalidate DKIM signatures.  All downstream DMARC processing with be unable to utilize DKIM to yield Authenticated Identifiers due to header rewriting.</p>
<p id="rfc.section.3.1.2.2.p.3">Providing solutions for issues relating to non RFC-compliant emails is outside the scope of this document.</p>
<h1 id="rfc.section.3.1.2.3"><a href="#rfc.section.3.1.2.3">3.1.2.3.</a> Content Validation</h1>
<p id="rfc.section.3.1.2.3.p.1">An MTA may also implement security-motivated changes to the content of email messages, dropping or altering sections of messages, causing breakage of DKIM signatures</p>
<h1 id="rfc.section.3.1.3"><a href="#rfc.section.3.1.3">3.1.3.</a> Message Delivery Agents</h1>
<p id="rfc.section.3.1.3.p.1">The MDA transfers a message from the MHS to a mailbox.  Like the MSA, the MDA consists of two sub-components: </p>

<ul>
  <li>MHS-focused MDA functions (hMDA)</li>
  <li>Recipient-focused MDA functions (rMDA)</li>
</ul>

<p> </p>
<p id="rfc.section.3.1.3.p.2">Both the hMDA and the rMDA can redirect a message to an alternative address.  DMARC interoperability issues related to redirecting of messages are described in <a href="#mediators">Section 3.2</a>.</p>
<p id="rfc.section.3.1.3.p.3">SIEVE <a href="#RFC5228">[RFC5228]</a> functionality often lives in the rMDA sub-component and can cause DMARC interoperability issues. The SIEVE 'addheader' and 'deleteheader' filtering actions can modify messages and invalidate DKIM signatures, removing DKIM-supplied Authenticated Identifiers as inputs to the DMARC mechanism. There are also SIEVE extensions that modify the body. SIEVE alterations may only become an issue when the email is reintroduced into the transport infrastructure.</p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#mediators" id="mediators">Mediators</a></h1>
<p><a href="#RFC5598">Mediators</a> <cite title="NONE">[RFC5598]</cite> forward messages through a re-posting process.  Mediators share some functionality with basic MTA relaying, but have greater flexibility in both addressing and content modifications.</p>
<p id="rfc.section.3.2.p.2">DMARC interoperability issues are common within the context of Mediators, which are often used precisely for their ability to modify messages.</p>
<p id="rfc.section.3.2.p.3">The DMARC design does not cope with some Mediator functionality such as content modifications that invalidate DKIM signatures and RFC5321.mailfrom rewriting to support SPF authentication of resent mail when the new Recipient receives the message from the Mediator rather than the initial organization.</p>
<h1 id="rfc.section.3.2.1"><a href="#rfc.section.3.2.1">3.2.1.</a> Alias</h1>
<p id="rfc.section.3.2.1.p.1">An Alias is a simple re-addressing facility that provides one or more new Internet Mail addresses, rather than a single, internal one.  A message continues through the transfer service for delivery to one or more alternative addresses.</p>
<p id="rfc.section.3.2.1.p.2">Aliases can be implemented by mailbox-level forwarding (e.g. through "dot-forwarding") or SIEVE-level forwarding (through the SIEVE 'redirect' action) or other methods.  When an Alias preserves message content and does not make significant header changes, DKIM signatures may remain valid.  However, Aliases often extend the delivery path outside of the scope covered by the originating ADMD's SPF record(s).</p>
<p id="rfc.section.3.2.1.p.3">Examples of Aliasing include: </p>

<ul>
  <li>Forwarding email between free email (freemail) providers to try different interfaces while maintaining an original email address;</li>
  <li>Consolidating many email addresses into a single account to centralize processing;</li>
  <li>Services that provide "activity based", "role based" , "vanity" or "temporary" email addresses such as universities and professional associations. For instance professional or alumni institutions may offer their members an alias for the duration of their membership but may not want to deal with the long term storage of emails.</li>
</ul>

<p> </p>
<p id="rfc.section.3.2.1.p.4">In most cases, the aMSA providing Alias services has no administrative relationship to the ADMD of the originator or the final recipient, so solutions to Alias-related DMARC failure should not assume such a relationship.</p>
<h1 id="rfc.section.3.2.2"><a href="#rfc.section.3.2.2">3.2.2.</a> <a href="#resenders" id="resenders">ReSenders</a></h1>
<p id="rfc.section.3.2.2.p.1">ReSenders "splice" a message's addressing information to connect the Author of the original message with the Recipient(s) of the new message.  The new Recipient sees the message as being from the original Author, even if the Mediator adds commentary.</p>
<p id="rfc.section.3.2.2.p.2">Without Authenticated Identifiers aligned with the Author's RFC5322.from header field domain, the new Recipient has no way to achieve a passing DMARC evaluation.</p>
<p id="rfc.section.3.2.2.p.3">Examples of ReSenders include MUA-level forwarding by resending a message to a new recipient or by forwarding a message "inline" to a new recipient (this does not include forwarding a message "as an attachment").  An additional example comes in the form of calendaring software that allows a meeting attendee (not the meeting organizer) to modify the content of an invite generating new invitations that claim to be reissued from the meeting organizer.</p>
<h1 id="rfc.section.3.2.3"><a href="#rfc.section.3.2.3">3.2.3.</a> Mailing Lists</h1>
<p id="rfc.section.3.2.3.p.1">A Mailing List receives messages as an explicit addressee and then reposts them to a list of subscribed members.  The Mailing List performs a task that can be viewed as an elaboration of the ReSender actions.</p>
<p id="rfc.section.3.2.3.p.2">Mailing Lists share the same DMARC interoperability issues as <a href="#resenders">ReSenders</a> <cite title="NONE">[resenders]</cite>, and very commonly modify headers or message content in ways that will cause DKIM to fail, including: </p>

<ul>
  <li>prepending the RFC5322.Subject header field with a tag, to allow the recipient to easily identify the mailing list within a subject line listing;</li>
  <li>adding a footer to the email body to contain administrative instructions;</li>
  <li>removing some MIME-parts from the email or converting the message to text only;</li>
  <li>PGP-encrypting or S/MIME encrypting the body with the receiver's key;</li>
  <li>enforcing community standards by rewriting banned words;</li>
  <li>allowing moderators to add arbitrary commentary to messages (discussed in <a href="#RFC6377">[RFC6377]</a>).</li>
</ul>

<p> Any such modifications would invalidate a DKIM signature.</p>
<p id="rfc.section.3.2.3.p.3">Header and content modifications are common for many mailing lists and are often central to present mailing list functionality and usage. Furthermore, MUAs have come to rely on mailing list message modifications to present messages to end users in expected ways.</p>
<h1 id="rfc.section.3.2.3.1"><a href="#rfc.section.3.2.3.1">3.2.3.1.</a> Mailing List Operational Effects</h1>
<p id="rfc.section.3.2.3.1.p.1">Mailing Lists may also have the following DMARC interoperability issues: </p>

<ul>
  <li>Subscribed members may not receive email from members that post using domains that publish a DMARC "p=reject" policy.</li>
  <li>Mailing Lists may interpret DMARC-related email rejections as an inability to deliver email to the recipients that are checking and enforcing DMARC policy.  This processing may cause subscribers that are checking and enforcing DMARC policy to be inadvertently suspended or removed from the Mailing List.</li>
</ul>

<p> </p>
<h1 id="rfc.section.3.2.4"><a href="#rfc.section.3.2.4">3.2.4.</a> Gateways</h1>
<p id="rfc.section.3.2.4.p.1">A Gateway performs the basic routing and transfer work of message relaying, but it also is permitted to modify content, structure, addressing, and/or other attributes as needed to send the message into a messaging environment that operates under different standards or potentially incompatible policies.</p>
<p id="rfc.section.3.2.4.p.2">Gateways share the same DMARC interoperability issues as <a href="#resenders">ReSenders</a> <cite title="NONE">[resenders]</cite>.</p>
<p id="rfc.section.3.2.4.p.3">Gateways may share also the same DMARC interoperability issues as <a href="#mta">MTAs</a> <cite title="NONE">[mta]</cite>.</p>
<p id="rfc.section.3.2.4.p.4">Receiver systems on the non-SMTP side of a protocol gateway may be unable to evaluate DKIM and SPF. If a message passes through a second protocol gateway back into the SMTP domain, the transformations commonly break the original DKIM signature(s).</p>
<p id="rfc.section.3.2.4.p.5">Gateway-level forwarding can introduce DMARC interoperability issues if the Gateway is configured to rewrite the message into alternate recipient domains.  For example, an acquisition may lead an acquiring company to decide to decommission the acquired company's domains by rewriting messages to use the domain of the acquiring company. Since the RFC5322.To header field is usually DKIM-signed, this kind of rewriting will invalidate such DKIM signatures.</p>
<h1 id="rfc.section.3.2.5"><a href="#rfc.section.3.2.5">3.2.5.</a> Boundary Filters</h1>
<p id="rfc.section.3.2.5.p.1">To enforce security boundaries, organizations can subject messages to analysis for conformance with their safety policies.  A filter might alter the content to render it safe, such as by removing or otherwise altering content deemed unacceptable.</p>
<p id="rfc.section.3.2.5.p.2">Boundary Filters share the same DMARC interoperability issues as ReSenders.</p>
<p id="rfc.section.3.2.5.p.3">Issues may arise with SPF and DKIM evaluation if performed after filter modifications.</p>
<p id="rfc.section.3.2.5.p.4">Examples of Boundary Filters include: </p>

<ul>
  <li>Malware scanning: To protect readers and its reputation, an MTA that transfers a message may remove content believed to be harmful from messages, reformulate content to canonical formats in order to make them more trustworthy or easier to scan, and/or add text in the body to indicate the message has been scanned. Any such modifications would invalidate a DKIM signature.</li>
  <li>Spam filtering: To protect reputation and assist other MTAs, an MTA may modify a message to indicate its decision that the message is likely to be unwanted, and/or add text in the body to indicate that such filtering has been done.</li>
  <li>Other text additions: An MTA may add an organizational disclaimer or advertisement, for instance.</li>
  <li>URL alteration: Some systems will rewrite or alter embedded URLs as a way to control the potential threat form malware.</li>
  <li>Secondary MX services: The secondary MX for an organization may be external to the normal mail processing for the organization, and queue and forward to the primary when it becomes available. This will not invalidate DKIM but will prevent the primary from validating SPF normally. In this case, however, it is inappropriate for a primary MX server to perform an SPF check against its own secondaries.  Rather, the secondary MX should perform this function and employ some trusted mechanism to communicate the results of the SPF, DKIM and DMARC evaluation(s) to the primary MX server.</li>
</ul>

<p> </p>
<h1 id="rfc.section.3.3"><a href="#rfc.section.3.3">3.3.</a> Combinations</h1>
<p id="rfc.section.3.3.p.1">Indirect email flows can be combined.  For example, a university student may subscribe to a mailing list (using his university email address) while this university email address is configured to forward all emails to a freemail or a post-education corporate account provider where a more permanent email address for this student exists. </p>
<p id="rfc.section.3.3.p.2">Within an organization the message may pass through various <a href="#mta">MTAs</a> <cite title="NONE">[mta]</cite>, each of which performs a different function (authentication, filtering, distribution, etc.) </p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> Possible Mitigations of Interoperability Issues</h1>
<p id="rfc.section.4.p.1">Solutions to interoperability issues between DMARC and indirect email flows vary widely in their scope and implications. They range from improvements to underlying processors, such as proper handling of multiple DKIM signatures, to more radical changes to the messaging architecture.  This section describes possible ways to address interoperability issues. Note that these particular mechanisms may not be considered "best practices" and may, in some cases, violate various conventions or expectations.</p>
<p id="rfc.section.4.p.2">Receivers sometimes need to deliver email messages that do not conform to any standard or protocol, but are otherwise desired by end users.  Mitigating the impact of DMARC on indirect email flows is especially important to receivers that operate services where ease of use and compatibility with existing email flows is a priority. </p>
<p id="rfc.section.4.p.3">DMARC provides a mechanism (local policy) for receivers to make decisions about identity alignment acceptability based on information outside DMARC and communicate those decisions as "overrides" to the sender. This facility can be used to ease some interoperability issues, although care is needed to ensure that this does not create loopholes for abuse.  </p>
<p id="rfc.section.4.p.4">To further complicate the usage of mitigations, mitigation may not be desired if the email in question is of a certain category of high value or high risk (security-related) transactional messages (dealing with financial transactions or medical records, for example).  In these cases, mitigating the impact of DMARC due to indirect email flows may not be desirable (counter-productive, or allowing for abuse).</p>
<p id="rfc.section.4.p.5">As a final note, mail systems are diverse and widely deployed. Systems of various ages and capabilities are expected to preserve interoperability with the rest of the SMTP ecosystem. For instance, Qmail is still used, although the base code has not been updated since 1998. ezmlm, a once popular mailing list manager, is still deployed but has not been updated since 1997, although a new version, ezmlm-idx exists. Old versions of other open and closed source MTAs are still commonly in operation. When dealing with aging or unsupported systems, some solutions may be time-consuming and/or disruptive to implement.</p>
<h1 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> Mitigations in Current Use</h1>
<p id="rfc.section.4.1.p.1">Because DMARC is already widely deployed, many operators already have mitigations in use. These mitigations vary in their effectiveness and side effects, but have the advantage that they are currently available.</p>
<h1 id="rfc.section.4.1.1"><a href="#rfc.section.4.1.1">4.1.1.</a> Mitigations for Senders</h1>
<h1 id="rfc.section.4.1.1.1"><a href="#rfc.section.4.1.1.1">4.1.1.1.</a> <a href="#IA" id="IA">Identifier Alignment</a></h1>
<p/>

<ul>
  <li>MTAs handling multiple domains may choose to change RFC5321.mailfrom to align with RFC5322.from to improve SPF usability for DMARC.</li>
  <li>MTAs handling multiple domains may also choose to align RFC5321.HELO/EHLO to RFC5322.from, particularly when sending non-delivery (also known as "bounce") messages (ref <a href="#RFC5321">[RFC5321]</a> section 3.6.3). Dynamically adjusting the RFC5321.HELO based on the RFC5322.from may not be possible for some MTA software.</li>
  <li>MTAs may choose to DKIM sign bounces with an aligned domain to allow DKIM-based DMARC pass.</li>
  <li>MTAs sending email on behalf of multiple domains may require Domain Owners to provide DKIM keys to use DKIM to avoid SPF validation issues, given the requirement for DMARC alignment with the RFC5322.from header field. Managing DKIM keys with a third party has security risks that should be carefully managed (see also <a href="#RFC6376">[RFC6376]</a> section 8). Methods involving CNAMEs and/or subdomains may alleviate some risks.</li>
  <li>Senders who are sending on behalf of users in other Administrative Domains may choose to use an RFC5322.from under the sender's control. The new From can be either a forwarding address in a domain controlled by the Sender, or a placeholder address, with the original user's address in a RFC5322.Reply-to header field. However, performing this modification may cause the recipient's MUA to deviate from customary behavior.</li>
  <li>When implementing "forward-to-friend" functionality one approach to avoid DMARC failures is to pass a well formed message to the user's MUA so that it may fill in an appropriate identity and submit through its own MSA.</li>
  <li>Senders can use domains with distinct DMARC policies for email sent directly and email known to use indirect mail flows. However, for known brands, all active domains are likely to be targeted equally by abusers.</li>
</ul>
<h1 id="rfc.section.4.1.1.2"><a href="#rfc.section.4.1.1.2">4.1.1.2.</a> Message Modification</h1>
<p/>

<ul>
  <li>Senders can maximize survivability of DKIM signatures by limiting the header fields they sign and using relaxed canonicalization.  Using the DKIM length tag to allow appended signatures is discouraged due to the security risk created by allowing arbitrary content to be appended to legitimate email.</li>
  <li>Senders can also maximize survivability by starting with RFC-compliant headers and common body formats.</li>
  <li>In order to minimize transport-based conversions, Senders can convert messages to a lowest denominator MIME content-transfer encoding such as quoted-printable or base64 before signing (<a href="#RFC6376">[RFC6376]</a> Section 5.3). </li>
</ul>

<p> </p>
<h1 id="rfc.section.4.1.2"><a href="#rfc.section.4.1.2">4.1.2.</a> Mitigations for Receivers</h1>
<h1 id="rfc.section.4.1.2.1"><a href="#rfc.section.4.1.2.1">4.1.2.1.</a> Identifier Alignment</h1>
<p/>

<ul>
  <li>Receivers should update DKIM handling libraries to ensure that they process all valid DKIM signatures and check each signature for alignment.</li>
</ul>
<h1 id="rfc.section.4.1.2.2"><a href="#rfc.section.4.1.2.2">4.1.2.2.</a> Policy Override</h1>
<p/>

<ul>
  <li>Receivers can amalgamate data from their user base to create lists of forwarders and use such lists to inform DMARC local policy overrides. This process may be easier for large receivers where data and resources to create such lists are more readily available than at smaller sites where the recipient footprint and other resources may be scarce.</li>
</ul>
<h1 id="rfc.section.4.1.3"><a href="#rfc.section.4.1.3">4.1.3.</a> Mitigations for ReSenders</h1>
<h1 id="rfc.section.4.1.3.1"><a href="#rfc.section.4.1.3.1">4.1.3.1.</a> Changes to the RFC5322.from</h1>
<p id="rfc.section.4.1.3.1.p.1">Many ReSender issues can be avoided by using an RFC5322.from header field under the ReSender's control, instead of the initial RFC5322.from. This will correct identifier alignment issues and allow arbitrary message modification as long as the ReSender signs the message with an aligned domain signature. When ReSenders change the RFC5322.from, it is desirable to preserve the information about the original initiator of the message.</p>
<p id="rfc.section.4.1.3.1.p.2">A first option is to use the <a href="#RFC5703">Original-From</a> <cite title="NONE">[RFC5703]</cite> (or X-Original-From) header field for this purpose in various contexts (X- header fields name are discouraged by <a href="#RFC6648">[RFC6648]</a>). However, handling of Original-From (or X-Original-From) is not defined anywhere. It is not currently used consistently or displayed to the user, and in any situation where it is used, it is a new unauthenticated identifier available for exploitation unless included within the scope of the new DKIM signature(s).</p>
<p id="rfc.section.4.1.3.1.p.3">Another option for ReSenders is to rewrite the RFC5322.from header field address to a locally controlled address which will be forwarded back to the original sender (subject to its own ReSender forwarding mitigations!).</p>
<h1 id="rfc.section.4.1.3.2"><a href="#rfc.section.4.1.3.2">4.1.3.2.</a> Avoiding Message Modification</h1>
<p/>

<ul>
  <li>Forwarders can choose to add email header fields instead of modifying existing headers or bodies, for instance to indicate a message may be spam.</li>
  <li>Forwarders can minimize the circumstances in which they choose to fix messages, preferring to preserve non-compliant headers to creating DKIM failures.</li>
  <li>Forwarders can choose to reject messages with suspect or harmful content instead of modifying them.</li>
</ul>
<h1 id="rfc.section.4.1.3.3"><a href="#rfc.section.4.1.3.3">4.1.3.3.</a> <a href="#mlm" id="mlm">Mailing Lists</a></h1>
<p><a href="#RFC6377">[RFC6377]</a> provides some guidance on using DKIM with Mailing lists. The following mitigation techniques can be used to ease interoperability issues with DMARC and Mailing lists: </p>

<ul>
  <li>Configuring the Mailing List Manager (MLM) to alter the RFC5322.from header field to use the domain of the MLM is a mitigation policy that is now present in several different Mailing List software distributions. Since most list subscribers prefer to know the identity of the author of the original message, typically this information may be provided in the display name part of the RFC5322.from header field. This display name needs to be carefully crafted as to not collide with the original display name of the author, nor contain something that looks like an email address or domain name. These modifications may to some extent defeat the purpose of DMARC itself. It may make it difficult to ensure that users of all email clients can easily reply to the author, the list, or all using the email client features provided for that purpose. Use of RFC5322.Reply-To header field can alleviate this problem depending on whether the mailing list is configured to reply-to-list, reply-to-author or reply-to-fixed-address, however it is important to note that this header field can take multiple email addresses. When altering the RFC5322.from there are three possibilities: <ol><li>change it to put the mailing list email address,</li><li>change it to a locally-defined address which will be forwarded back to the original sender, or</li><li>"break" the address by modifying the domain to a non-existent domain (such as by adding a suffix like ".invalid".) </li></ol><p> The latter modification may create issues because it is an invalid domain name, and some MTAs may pay particular attention to the validity of email addresses in RFC5322.from and the reputation of the domains present there.</p></li>
  <li>Configuring the MLM to "wrap" the message in a MIME message/rfc822 part and to send as the Mailing List email address. Many email clients (as of August 2015), especially mobile clients, have difficulty reading such messages and this is not expected to change soon.</li>
  <li>Configuring the MLM to not modify the message so that the DKIM signature remains valid. Some Mailing Lists are set up this way and require few additional changes to ensure the DKIM signature is preserved. Moving lists that currently modify mail to a policy like this, may be too much of a change for the members of such lists.</li>
  <li>Rejecting posts or membership requests from domains with a DMARC policy other than "p=none". However members or potential members of such  Mailing  Lists may complain of unfair exclusion.</li>
  <li>To alleviate unsubscribes to the Mailing List due to the messages bouncing because of DMARC, the MLM needs to not act on bounces due to Message Authentication issues. <a href="#RFC3463">[RFC3463]</a> specifies Enhanced Mail System Status Codes which help differentiate between various bounces. Correctly interpreting Extended SMTP error messages is useful in this case. In particular, extended status codes are defined in <a href="#RFC7372">[RFC7372]</a> and in <a href="#RFC7489">DMARC</a> <cite title="NONE">[RFC7489]</cite>.</li>
</ul>

<p> All these techniques may provide some specific challenges to MUAs and different operational usages for end users (like rewriting filters to sort emails in folders). There will be some time before all implications are understood and accommodated. </p>
<h1 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> Proposed and In-Progress Mitigations</h1>
<p id="rfc.section.4.2.p.1">The following mitigations are based on Internet Drafts (I-Ds) which have not yet received broad consensus. They are described here to offer exploratory path for solutions. These solutions should not be used in a production environment. Because of the transient nature of I-Ds, specific citations are not included because a number of them will inevitably become obsolete and those which gain concensus in the community will become RFCs and should be discovered as such.  </p>

<ul>
  <li>Third party authorization schemes provide ways to extend identifier alignment under control of the domain owner.</li>
  <li>Ways to canonicalize messages that transit mailing lists so that their alterations can be isolated from the original signed content.</li>
  <li>Mechanisms to record message transformations applied at each hop so they can be reversed and the original signed content recovered.</li>
  <li>"Conditional" DKIM signatures, whereby the author domain indicates its signature is only good if accompanied by a signature from an expected downstream relay.</li>
  <li>Mechanisms to extend <a href="#RFC7601">Authentication-Results</a> <cite title="NONE">[RFC7601]</cite> to multiple hops, creating a provable chain of custody as well as a view of message authentication results at each handling step.</li>
</ul>

<p> </p>
<h1 id="rfc.section.4.2.1"><a href="#rfc.section.4.2.1">4.2.1.</a> Getting More Radical: Requiring New Communication Paths Between MUAs</h1>
<p id="rfc.section.4.2.1.p.1">In practice a number of operators are using strict alignment mode in DMARC in order to avoid receiving new and innovative forms of unwanted and unauthentic email through systems purporting to be mailing list handlers.  The receiving ADMD has no knowledge of which lists the user has subscribed to and which they have not.  One avenue of exploration would be for the user to authorize mailing lists as proxies for authentication, at which point the receiving ADMD would be vesting some trust in the mailing list service.  The creators of DKIM foresaw precisely this possibility at the time by not tightly binding any semantics to the RFC5322.from header field.  Some experimental work has taken place in this area, as mentioned above.  Additional work might examine a new communication path to the user to authorize some form of transitive trust.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#IANA" id="IANA">IANA Considerations</a></h1>
<p id="rfc.section.5.p.1">This document contains no actions for IANA.  [RFC Editor: Please delete this section prior to publication.]</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#Security" id="Security">Security Considerations</a></h1>
<p id="rfc.section.6.p.1">This document is an analysis of DMARC's impact on indirect email flows.  It describes the possibility of accidental denial-of-service that can be created by rejections of messages by DMARC-aware Mail Receivers.</p>
<p id="rfc.section.6.p.2">In <a href="#IA">Section 4.1.1.1</a>, discusses the importance of appropriate DKIM key management vis a vis third party email senders.</p>
<p id="rfc.section.6.p.3">In <a href="#mlm">Section 4.1.3.3</a>, warns that rewriting the RFC5322.from header field and changing the domain name should not be done with any domain.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#ack" id="ack">Acknowledgments</a></h1>
<p id="rfc.section.7.p.1">Miles Fidelman, John Levine, David Crocker, Stephen J. Turnbull, Rolf E. Sonneveld, Tim Draegen and Franck Martin contributed to the IETF DMARC Working Group's wiki page listing all known interoperability issues with DMARC and indirect email flows.</p>
<p id="rfc.section.7.p.2">Tim Draegen created the first draft of this document from these contributions and by hamfistedly mapping contributions into the language of <a href="#RFC5598">[RFC5598]</a>.</p>
<h1 id="rfc.references"><a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC2045">[RFC2045]</b>
      </td>
      <td class="top"><a>Freed, N.</a> and <a>N. Borenstein</a>, "<a href="http://tools.ietf.org/html/rfc2045">Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>", RFC 2045, DOI 10.17487/RFC2045, November 1996.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3463">[RFC3463]</b>
      </td>
      <td class="top"><a>Vaudreuil, G.</a>, "<a href="http://tools.ietf.org/html/rfc3463">Enhanced Mail System Status Codes</a>", RFC 3463, DOI 10.17487/RFC3463, January 2003.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5228">[RFC5228]</b>
      </td>
      <td class="top"><a>Guenther, P.</a> and <a>T. Showalter</a>, "<a href="http://tools.ietf.org/html/rfc5228">Sieve: An Email Filtering Language</a>", RFC 5228, DOI 10.17487/RFC5228, January 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5321">[RFC5321]</b>
      </td>
      <td class="top"><a>Klensin, J.</a>, "<a href="http://tools.ietf.org/html/rfc5321">Simple Mail Transfer Protocol</a>", RFC 5321, DOI 10.17487/RFC5321, October 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5322">[RFC5322]</b>
      </td>
      <td class="top"><a>Resnick, P.</a>, "<a href="http://tools.ietf.org/html/rfc5322">Internet Message Format</a>", RFC 5322, DOI 10.17487/RFC5322, October 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5598">[RFC5598]</b>
      </td>
      <td class="top"><a>Crocker, D.</a>, "<a href="http://tools.ietf.org/html/rfc5598">Internet Mail Architecture</a>", RFC 5598, DOI 10.17487/RFC5598, July 2009.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5703">[RFC5703]</b>
      </td>
      <td class="top"><a>Hansen, T.</a> and <a>C. Daboo</a>, "<a href="http://tools.ietf.org/html/rfc5703">Sieve Email Filtering: MIME Part Tests, Iteration, Extraction, Replacement, and Enclosure</a>", RFC 5703, DOI 10.17487/RFC5703, October 2009.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6376">[RFC6376]</b>
      </td>
      <td class="top"><a>Crocker, D.</a>, <a>Hansen, T.</a> and <a>M. Kucherawy</a>, "<a href="http://tools.ietf.org/html/rfc6376">DomainKeys Identified Mail (DKIM) Signatures</a>", STD 76, RFC 6376, DOI 10.17487/RFC6376, September 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6377">[RFC6377]</b>
      </td>
      <td class="top"><a>Kucherawy, M.</a>, "<a href="http://tools.ietf.org/html/rfc6377">DomainKeys Identified Mail (DKIM) and Mailing Lists</a>", BCP 167, RFC 6377, DOI 10.17487/RFC6377, September 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6648">[RFC6648]</b>
      </td>
      <td class="top"><a>Saint-Andre, P.</a>, <a>Crocker, D.</a> and <a>M. Nottingham</a>, "<a href="http://tools.ietf.org/html/rfc6648">Deprecating the "X-" Prefix and Similar Constructs in Application Protocols</a>", BCP 178, RFC 6648, DOI 10.17487/RFC6648, June 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7208">[RFC7208]</b>
      </td>
      <td class="top"><a>Kitterman, S.</a>, "<a href="http://tools.ietf.org/html/rfc7208">Sender Policy Framework (SPF) for Authorizing Use of Domains in Email, Version 1</a>", RFC 7208, DOI 10.17487/RFC7208, April 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7372">[RFC7372]</b>
      </td>
      <td class="top"><a>Kucherawy, M.</a>, "<a href="http://tools.ietf.org/html/rfc7372">Email Authentication Status Codes</a>", RFC 7372, DOI 10.17487/RFC7372, September 2014.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC7489">[RFC7489]</b>
      </td>
      <td class="top"><a>Kucherawy, M.</a> and <a>E. Zwicky</a>, "<a href="http://tools.ietf.org/html/rfc7489">Domain-based Message Authentication, Reporting, and Conformance (DMARC)</a>", RFC 7489, DOI 10.17487/RFC7489, March 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7601">[RFC7601]</b>
      </td>
      <td class="top"><a>Kucherawy, M.</a>, "<a href="http://tools.ietf.org/html/rfc7601">Message Header Field for Indicating Message Authentication Status</a>", RFC 7601, DOI 10.17487/RFC7601, August 2015.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Franck Martin</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Martin</span>
	  </span>
	</span>
	<span class="org vcardline">LinkedIn</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Mountain View</span>,  
		<span class="region">CA</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:fmartin@linkedin.com">fmartin@linkedin.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Eliot Lear</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Lear</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems GmbH</span>
	<span class="adr">
	  <span class="vcardline">Richtistrasse 7</span>

	  <span class="vcardline">
		<span class="locality">Wallisellen</span>,  
		<span class="region">ZH</span> 
		<span class="code">CH-8304</span>
	  </span>
	  <span class="country-name vcardline">Switzerland</span>
	</span>
	<span class="vcardline">Phone: +41 44 878 9200</span>

<span class="vcardline">EMail: <a href="mailto:lear@cisco.com">lear@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Tim Draegen</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Draegen</span>
	  </span>
	</span>
	<span class="org vcardline">dmarcian, inc.</span>
	<span class="adr">
	  <span class="vcardline">PO Box 1007</span>

	  <span class="vcardline">
		<span class="locality">Brevard</span>,  
		<span class="region">NC</span> 
		<span class="code">28712</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:tim@dmarcian.com">tim@dmarcian.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Elizabeth Zwicky</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Zwicky</span>
	  </span>
	</span>
	<span class="org vcardline">Yahoo</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Sunnyvale</span>,  
		<span class="region">CA</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:zwicky@yahoo-inc.com">zwicky@yahoo-inc.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Kurt Andersen</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Andersen</span>
	  </span>
	</span>
	<span class="org vcardline">LinkedIn</span>
	<span class="adr">
	  <span class="vcardline">2029 Stierlin Court</span>

	  <span class="vcardline">
		<span class="locality">Mt. View</span>,  
		<span class="region">CA</span> 
		<span class="code">94043</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:kandersen@linkedin.com">kandersen@linkedin.com</a></span>

  </address>
</div>

</body>
</html>
